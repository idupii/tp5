!function(window,undefined){function _isArray(a){return a?"[object Array]"===Object.prototype.toString.call(a):!1}function _isFunction(a){return a?"[object Function]"===Object.prototype.toString.call(a):!1}function _inArray(a,c){for(var i=0,h=c.length;h>i;i++)if(a===c[i])return i;return-1}function _each(a,c){if(_isArray(a))for(var i=0,h=a.length;h>i&&c.call(a[i],i,a[i])!==!1;i++);else for(var _ in a)if(a.hasOwnProperty(_)&&c.call(a[_],_,a[_])===!1)break}function _trim(a){return a.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function _inString(a,c,h){return h=h===undefined?",":h,(h+c+h).indexOf(h+a+h)>=0}function _addUnit(a,c){return c=c||"px",a&&/^\d+$/.test(a)?a+c:a}function _removeUnit(a){var c;return a&&(c=/(\d+)/.exec(a))?parseInt(c[1],10):0}function _escape(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _unescape(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function _toCamel(a){var c=a.split("-");return a="",_each(c,function(c,h){a+=c>0?h.charAt(0).toUpperCase()+h.substr(1):h}),a}function _toHex(a){function c(d){var s=parseInt(d,10).toString(16).toUpperCase();return s.length>1?s:"0"+s}return a.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi,function(a,h,_,g){return"#"+c(h)+c(_)+c(g)})}function _toMap(a,c){c=c===undefined?",":c;var h,_={},g=_isArray(a)?a:a.split(c);return _each(g,function(a,c){if(h=/^(\d+)\.\.(\d+)$/.exec(c))for(var i=parseInt(h[1],10);i<=parseInt(h[2],10);i++)_[i.toString()]=!0;else _[c]=!0}),_}function _toArray(a,c){return Array.prototype.slice.call(a,c||0)}function _undef(a,c){return a===undefined?c:a}function _invalidUrl(a){return!a||/[<>"]/.test(a)}function _addParam(a,c){return a.indexOf("?")>=0?a+"&"+c:a+"?"+c}function _extend(a,c,h){h||(h=c,c=null);var _;if(c){var g=function(){};g.prototype=c.prototype,_=new g,_each(h,function(a,c){_[a]=c})}else _=h;_.constructor=a,a.prototype=_,a.parent=c?c.prototype:null}function _json(text){var match;(match=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(text))&&(text=match[0]);var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+text+")");throw"JSON parse error"}function _getBasePath(){for(var a,c=document.getElementsByTagName("script"),i=0,h=c.length;h>i;i++)if(a=c[i].src||"",/kindeditor[\w\-\.]*\.js/.test(a))return a.substring(0,a.lastIndexOf("/")+1);return""}function _bindEvent(a,c,h){a.addEventListener?a.addEventListener(c,h,_useCapture):a.attachEvent&&a.attachEvent("on"+c,h)}function _unbindEvent(a,c,h){a.removeEventListener?a.removeEventListener(c,h,_useCapture):a.detachEvent&&a.detachEvent("on"+c,h)}function KEvent(a,c){this.init(a,c)}function _getId(a){return a[_eventExpendo]||null}function _setId(a){return a[_eventExpendo]=++_eventId,_eventId}function _removeId(a){try{delete a[_eventExpendo]}catch(e){a.removeAttribute&&a.removeAttribute(_eventExpendo)}}function _bind(a,c,h){if(c.indexOf(",")>=0)return void _each(c.split(","),function(){_bind(a,this,h)});var _=_getId(a);_||(_=_setId(a)),_eventData[_]===undefined&&(_eventData[_]={});var g=_eventData[_][c];g&&g.length>0?_unbindEvent(a,c,g[0]):(_eventData[_][c]=[],_eventData[_].el=a),g=_eventData[_][c],0===g.length&&(g[0]=function(e){var c=e?new KEvent(a,e):undefined;_each(g,function(i,h){i>0&&h&&h.call(a,c)})}),_inArray(h,g)<0&&g.push(h),_bindEvent(a,c,g[0])}function _unbind(a,c,h){if(c&&c.indexOf(",")>=0)return void _each(c.split(","),function(){_unbind(a,this,h)});var _=_getId(a);if(_){if(c===undefined)return void(_ in _eventData&&(_each(_eventData[_],function(c,h){"el"!=c&&h.length>0&&_unbindEvent(a,c,h[0])}),delete _eventData[_],_removeId(a)));if(_eventData[_]){var g=_eventData[_][c];if(g&&g.length>0){h===undefined?(_unbindEvent(a,c,g[0]),delete _eventData[_][c]):(_each(g,function(i,a){i>0&&a===h&&g.splice(i,1)}),1==g.length&&(_unbindEvent(a,c,g[0]),delete _eventData[_][c]));var v=0;_each(_eventData[_],function(){v++}),2>v&&(delete _eventData[_],_removeId(a))}}}}function _fire(a,c){if(c.indexOf(",")>=0)return void _each(c.split(","),function(){_fire(a,this)});var h=_getId(a);if(h){var _=_eventData[h][c];_eventData[h]&&_&&_.length>0&&_[0]()}}function _ctrl(a,c,h){c=/^\d{2,}$/.test(c)?c:c.toUpperCase().charCodeAt(0),_bind(a,"keydown",function(e){!e.ctrlKey||e.which!=c||e.shiftKey||e.altKey||(h.call(a),e.stop())})}function _ready(a){function c(){g||(g=!0,a(KindEditor),_readyFinished=!0)}function h(){if(!g){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(h,100)}c()}}function _(){"complete"===document.readyState&&c()}if(_readyFinished)return void a(KindEditor);var g=!1;if(document.addEventListener)_bind(document,"DOMContentLoaded",c);else if(document.attachEvent){_bind(document,"readystatechange",_);var v=!1;try{v=null==window.frameElement}catch(e){}document.documentElement.doScroll&&v&&h()}_bind(window,"load",c)}function _getCssList(a){for(var c,h={},_=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g;c=_.exec(a);){var g=_trim(c[1].toLowerCase()),v=_trim(_toHex(c[2]));h[g]=v}return h}function _getAttrList(a){for(var c,h={},_=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g;c=_.exec(a);){var g=(c[1]||c[2]||c[4]||c[6]).toLowerCase(),v=(c[2]?c[3]:c[4]?c[5]:c[7])||"";h[g]=v}return h}function _addClassToTag(a,c){return a=/\s+class\s*=/.test(a)?a.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(a,h,_,g){return(" "+_+" ").indexOf(" "+c+" ")<0?""===_?h+c+g:h+_+" "+c+g:a}):a.substr(0,a.length-1)+' class="'+c+'">'}function _formatCss(a){var c="";return _each(_getCssList(a),function(a,h){c+=a+":"+h+";"}),c}function _formatUrl(a,c,h,_){function g(a){for(var c=a.split("/"),h=[],i=0,_=c.length;_>i;i++){var g=c[i];".."==g?h.length>0&&h.pop():""!==g&&"."!=g&&h.push(g)}return"/"+h.join("/")}function v(c,h){if(a.substr(0,c.length)===c){for(var g=[],i=0;h>i;i++)g.push("..");var y=".";return g.length>0&&(y+="/"+g.join("/")),"/"==_&&(y+="/"),y+a.substr(c.length)}return(b=/^(.*)\//.exec(c))?v(b[1],++h):void 0}if(c=_undef(c,"").toLowerCase(),"data:"!=a.substr(0,5)&&(a=a.replace(/([^:])\/\//g,"$1/")),_inArray(c,["absolute","relative","domain"])<0)return a;if(h=h||location.protocol+"//"+location.host,_===undefined){var m=location.pathname.match(/^(\/.*)\//);_=m?m[1]:""}var b;if(b=/^(\w+:\/\/[^\/]*)/.exec(a)){if(b[1]!==h)return a}else if(/^\w+:/.test(a))return a;return/^\//.test(a)?a=h+g(a.substr(1)):/^\w+:\/\//.test(a)||(a=h+g(_+"/"+a)),"relative"===c?a=v(h+_,0).substr(2):"absolute"===c&&a.substr(0,h.length)===h&&(a=a.substr(h.length)),a}function _formatHtml(a,c,h,_,g){null==a&&(a=""),h=h||"",_=_undef(_,!1),g=_undef(g,"	");var v="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");a=a.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(a,c,h,_){return c+h.replace(/<(?:br|br\s[^>]*)>/gi,"\n")+_}),a=a.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/gi,"</p>"),a=a.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/gi,"$1<br />$2"),a=a.replace(/\u200B/g,""),a=a.replace(/\u00A9/g,"&copy;"),a=a.replace(/\u00AE/g,"&reg;"),a=a.replace(/<[^>]+/g,function(a){return a.replace(/\s+/g," ")});var b={};c&&(_each(c,function(a,c){for(var h=a.split(","),i=0,_=h.length;_>i;i++)b[h[i]]=_toMap(c)}),b.script||(a=a.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/gi,"")),b.style||(a=a.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/gi,"")));var re=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g,y=[];return a=a.replace(re,function(a,k,C,E,K,T,w){var A=a,N=k||"",S=C||"",M=E.toLowerCase(),I=K||"",O=T?" "+T:"",D=w||"";if(c&&!b[M])return"";if(""===O&&_SINGLE_TAG_MAP[M]&&(O=" /"),_INLINE_TAG_MAP[M]&&(N&&(N=" "),D&&(D=" ")),_PRE_TAG_MAP[M]&&(S?D="\n":N="\n"),_&&"br"==M&&(D="\n"),_BLOCK_TAG_MAP[M]&&!_PRE_TAG_MAP[M])if(_){S&&y.length>0&&y[y.length-1]===M?y.pop():y.push(M),N="\n",D="\n";for(var i=0,P=S?y.length:y.length-1;P>i;i++)N+=g,S||(D+=g);O?y.pop():S||(D+=g)}else N=D="";if(""!==I){var R=_getAttrList(A);if("font"===M){var B={},H="";_each(R,function(a,c){"color"===a&&(B.color=c,delete R[a]),"size"===a&&(B["font-size"]=v[parseInt(c,10)-1]||"",delete R[a]),"face"===a&&(B["font-family"]=c,delete R[a]),"style"===a&&(H=c)}),H&&!/;$/.test(H)&&(H+=";"),_each(B,function(a,c){""!==c&&(/\s/.test(c)&&(c="'"+c+"'"),H+=a+":"+c+";")}),R.style=H}_each(R,function(a,_){if(_FILL_ATTR_MAP[a]&&(R[a]=a),_inArray(a,["src","href"])>=0&&(R[a]=_formatUrl(_,h)),(c&&"style"!==a&&!b[M]["*"]&&!b[M][a]||"body"===M&&"contenteditable"===a||/^kindeditor_\d+$/.test(a))&&delete R[a],"style"===a&&""!==_){var g=_getCssList(_);_each(g,function(a){!c||b[M].style||b[M]["."+a]||delete g[a]});var v="";_each(g,function(a,c){v+=a+":"+c+";"}),R.style=v}}),I="",_each(R,function(a,c){("style"!==a||""!==c)&&(c=c.replace(/"/g,"&quot;"),I+=" "+a+'="'+c+'"')})}return"font"===M&&(M="span"),N+"<"+S+M+I+O+">"+D}),a=a.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(a,c,h,_){return c+h.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+_}),a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n"),_trim(a)}function _clearMsWord(a,c){return a=a.replace(/<meta[\s\S]*?>/gi,"").replace(/<![\s\S]*?>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/gi,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/gi,"").replace(/<xml>[\s\S]*?<\/xml>/gi,"").replace(/<(?:table|td)[^>]*>/gi,function(a){return a.replace(/border-bottom:([#\w\s]+)/gi,"border:$1")}),_formatHtml(a,c)}function _mediaType(a){return/\.(rm|rmvb)(\?|$)/i.test(a)?"audio/x-pn-realaudio-plugin":/\.(swf|flv)(\?|$)/i.test(a)?"application/x-shockwave-flash":"video/x-ms-asf-plugin"}function _mediaClass(a){return/realaudio/i.test(a)?"ke-rm":/flash/i.test(a)?"ke-flash":"ke-media"}function _mediaAttrs(a){return _getAttrList(unescape(a))}function _mediaEmbed(a){var c="<embed ";return _each(a,function(a,h){c+=a+'="'+h+'" '}),c+="/>"}function _mediaImg(a,c){var h=c.width,_=c.height,g=c.type||_mediaType(c.src),v=_mediaEmbed(c),b="";/\D/.test(h)?b+="width:"+h+";":h>0&&(b+="width:"+h+"px;"),/\D/.test(_)?b+="height:"+_+";":_>0&&(b+="height:"+_+"px;");var y='<img class="'+_mediaClass(g)+'" src="'+a+'" ';return""!==b&&(y+='style="'+b+'" '),y+='data-ke-tag="'+escape(v)+'" alt="" />'}function _tmpl(a,c){var h=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return c?h(c):h}function _contains(a,c){if(9==a.nodeType&&9!=c.nodeType)return!0;for(;c=c.parentNode;)if(c==a)return!0;return!1}function _getAttr(a,c){c=c.toLowerCase();var h=null;if(_GET_SET_ATTRIBUTE||"script"==a.nodeName.toLowerCase())try{h=a.getAttribute(c,2)}catch(e){h=a.getAttribute(c,1)}else{var _=a.ownerDocument.createElement("div");_.appendChild(a.cloneNode(!1));var g=_getAttrList(_unescape(_.innerHTML));c in g&&(h=g[c])}return"style"===c&&null!==h&&(h=_formatCss(h)),h}function _queryAll(a,c){function h(a){return"string"!=typeof a?a:a.replace(/([^\w\-])/g,"\\$1")}function _(a){return a.replace(/\\/g,"")}function g(a,c){return"*"===a||a.toLowerCase()===h(c.toLowerCase())}function v(a,c,h){var v=[],b=h.ownerDocument||h,y=b.getElementById(_(a));return y&&g(c,y.nodeName)&&_contains(h,y)&&v.push(y),v}function b(a,c,h){var v,i,b,y,k=h.ownerDocument||h,C=[];if(h.getElementsByClassName)for(v=h.getElementsByClassName(_(a)),i=0,b=v.length;b>i;i++)y=v[i],g(c,y.nodeName)&&C.push(y);else if(k.querySelectorAll)for(v=k.querySelectorAll(("#document"!==h.nodeName?h.nodeName+" ":"")+c+"."+a),i=0,b=v.length;b>i;i++)y=v[i],_contains(h,y)&&C.push(y);else for(v=h.getElementsByTagName(c),a=" "+a+" ",i=0,b=v.length;b>i;i++)if(y=v[i],1==y.nodeType){var E=y.className;E&&(" "+E+" ").indexOf(a)>-1&&C.push(y)}return C}function y(a,c,h){for(var v,b=[],y=h.ownerDocument||h,k=y.getElementsByName(_(a)),i=0,C=k.length;C>i;i++)v=k[i],g(c,v.nodeName)&&_contains(h,v)&&null!==v.getAttribute("name")&&b.push(v);return b}function k(a,c,_,g){for(var v,b=[],y=g.getElementsByTagName(_),i=0,k=y.length;k>i;i++)v=y[i],1==v.nodeType&&(null===c?null!==_getAttr(v,a)&&b.push(v):c===h(_getAttr(v,a))&&b.push(v));return b}function C(a,c){var h,_=[];h=/^((?:\\.|[^.#\s\[<>])+)/.exec(a);var g=h?h[1]:"*";if(h=/#((?:[\w\-]|\\.)+)$/.exec(a))_=v(h[1],g,c);else if(h=/\.((?:[\w\-]|\\.)+)$/.exec(a))_=b(h[1],g,c);else if(h=/\[((?:[\w\-]|\\.)+)\]/.exec(a))_=k(h[1].toLowerCase(),null,g,c);else if(h=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(a)){var C=h[1].toLowerCase(),E=h[2];_="id"===C?v(E,g,c):"class"===C?b(E,g,c):"name"===C?y(E,g,c):k(C,E,g,c)}else for(var K,T=c.getElementsByTagName(g),i=0,w=T.length;w>i;i++)K=T[i],1==K.nodeType&&_.push(K);return _}var E=a.split(",");if(E.length>1){var K=[];return _each(E,function(){_each(_queryAll(this,c),function(){_inArray(this,K)<0&&K.push(this)})}),K}c=c||document;for(var T,w=[],re=/((?:\\.|[^\s>])+|[\s>])/g;T=re.exec(a);)" "!==T[1]&&w.push(T[1]);var A=[];if(1==w.length)return C(w[0],c);var N,S,M,I,O,i,D,P,R,l,B=!1;for(i=0,lenth=w.length;lenth>i;i++)if(N=w[i],">"!==N){if(i>0){for(S=[],D=0,R=A.length;R>D;D++)for(I=A[D],M=C(N,I),P=0,l=M.length;l>P;P++)O=M[P],B?I===O.parentNode&&S.push(O):S.push(O);A=S}else A=C(N,c);if(0===A.length)return[]}else B=!0;return A}function _query(a,c){var h=_queryAll(a,c);return h.length>0?h[0]:null}function _get(a){return K(a)[0]}function _getDoc(a){return a?a.ownerDocument||a.document||a:document}function _getWin(a){if(!a)return window;var c=_getDoc(a);return c.parentWindow||c.defaultView}function _setHtml(a,c){if(1==a.nodeType){var h=_getDoc(a);try{a.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+c;var _=h.getElementById("__kindeditor_temp_tag__");_.parentNode.removeChild(_)}catch(e){K(a).empty(),K("@"+c,h).each(function(){a.appendChild(this)})}}}function _hasClass(a,c){return _inString(c,a.className," ")}function _setAttr(a,c,h){_IE&&8>_V&&"class"==c.toLowerCase()&&(c="className"),a.setAttribute(c,""+h)}function _removeAttr(a,c){_IE&&8>_V&&"class"==c.toLowerCase()&&(c="className"),_setAttr(a,c,""),a.removeAttribute(c)}function _getNodeName(a){return a&&a.nodeName?a.nodeName.toLowerCase():""}function _computedCss(a,c){var h=_getWin(a),_=_toCamel(c),g="";if(h.getComputedStyle){var v=h.getComputedStyle(a,null);g=v[_]||v.getPropertyValue(c)||a.style[_]}else a.currentStyle&&(g=a.currentStyle[_]||a.style[_]);return g}function _hasVal(a){return!!_VALUE_TAG_MAP[_getNodeName(a)]}function _docElement(a){return a=a||document,_QUIRKS?a.body:a.documentElement}function _docHeight(a){var c=_docElement(a);return Math.max(c.scrollHeight,c.clientHeight)}function _docWidth(a){var c=_docElement(a);return Math.max(c.scrollWidth,c.clientWidth)}function _getScrollPos(a){a=a||document;var x,c;return _IE||_NEWIE||_OPERA?(x=_docElement(a).scrollLeft,c=_docElement(a).scrollTop):(x=_getWin(a).scrollX,c=_getWin(a).scrollY),{x:x,y:c}}function KNode(a){this.init(a)}function _updateCollapsed(a){return a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a}function _copyAndDelete(a,c,h){function _(_,g,v){var b,k=_.nodeValue.length;if(c){var C=_.cloneNode(!0);b=g>0?C.splitText(g):C,k>v&&b.splitText(v-g)}if(h){var E=_;if(g>0&&(E=_.splitText(g),a.setStart(_,g)),k>v){var K=E.splitText(v-g);a.setEnd(K,0)}y.push(E)}return b}function g(){h&&a.up().collapse(!0);for(var i=0,c=y.length;c>i;i++){var _=y[i];_.parentNode&&_.parentNode.removeChild(_)}}function v(g,w){for(var A,N=g.firstChild;N;){var S=new KRange(b).selectNode(N);if(C=S.compareBoundaryPoints(_START_TO_END,a),C>=0&&0>=E&&(E=S.compareBoundaryPoints(_START_TO_START,a)),E>=0&&0>=K&&(K=S.compareBoundaryPoints(_END_TO_END,a)),K>=0&&0>=T&&(T=S.compareBoundaryPoints(_END_TO_START,a)),T>=0)return!1;if(A=N.nextSibling,C>0)if(1==N.nodeType)if(E>=0&&0>=K)c&&w.appendChild(N.cloneNode(!0)),h&&y.push(N);else{var M;if(c&&(M=N.cloneNode(!1),w.appendChild(M)),v(N,M)===!1)return!1}else if(3==N.nodeType){var I;if(I=N==k.startContainer?_(N,k.startOffset,N.nodeValue.length):N==k.endContainer?_(N,0,k.endOffset):_(N,0,N.nodeValue.length),c)try{w.appendChild(I)}catch(e){}}N=A}}var b=a.doc,y=[],k=a.cloneRange().down(),C=-1,E=-1,K=-1,T=-1,w=a.commonAncestor(),A=b.createDocumentFragment();if(3==w.nodeType){var N=_(w,a.startOffset,a.endOffset);return c&&A.appendChild(N),g(),c?A:a}v(w,A),h&&a.up().collapse(!0);for(var i=0,S=y.length;S>i;i++){var M=y[i];M.parentNode&&M.parentNode.removeChild(M)}return c?A:a}function _moveToElementText(a,c){for(var h=c;h;){var _=K(h);if("marquee"==_.name||"select"==_.name)return;h=h.parentNode}try{a.moveToElementText(c)}catch(e){}}function _getStartEnd(a,c){var h=a.parentElement().ownerDocument,_=a.duplicate();_.collapse(c);var g=_.parentElement(),v=g.childNodes;if(0===v.length)return{node:g.parentNode,offset:K(g).index()};var b=h,y=0,k=-1,C=a.duplicate();_moveToElementText(C,g);for(var i=0,E=v.length;E>i;i++){var T=v[i];if(k=C.compareEndPoints("StartToStart",_),0===k)return{node:T.parentNode,offset:i};if(1==T.nodeType){var w,A=a.duplicate(),N=K(T),S=T;N.isControl()&&(w=h.createElement("span"),N.after(w),S=w,y+=N.text().replace(/\r\n|\n|\r/g,"").length),_moveToElementText(A,S),C.setEndPoint("StartToEnd",A),k>0?y+=A.text.replace(/\r\n|\n|\r/g,"").length:y=0,w&&K(w).remove()}else 3==T.nodeType&&(C.moveStart("character",T.nodeValue.length),y+=T.nodeValue.length);0>k&&(b=T)}if(0>k&&1==b.nodeType)return{node:g,offset:K(g.lastChild).index()+1};if(k>0)for(;b.nextSibling&&1==b.nodeType;)b=b.nextSibling;if(C=a.duplicate(),_moveToElementText(C,g),C.setEndPoint("StartToEnd",_),y-=C.text.replace(/\r\n|\n|\r/g,"").length,k>0&&3==b.nodeType)for(var M=b.previousSibling;M&&3==M.nodeType;)y-=M.nodeValue.length,M=M.previousSibling;return{node:b,offset:y}}function _getEndRange(a,c){var h=a.ownerDocument||a,_=h.body.createTextRange();if(h==a)return _.collapse(!0),_;if(1==a.nodeType&&a.childNodes.length>0){var g,v,b=a.childNodes;if(0===c?(v=b[0],g=!0):(v=b[c-1],g=!1),!v)return _;if("head"===K(v).name)return 1===c&&(g=!0),2===c&&(g=!1),_.collapse(g),_;if(1==v.nodeType){var y,k=K(v);return k.isControl()&&(y=h.createElement("span"),g?k.before(y):k.after(y),v=y),_moveToElementText(_,v),_.collapse(g),y&&K(y).remove(),_}a=v,c=g?0:v.nodeValue.length}var C=h.createElement("span");return K(a).before(C),_moveToElementText(_,C),_.moveStart("character",c),K(C).remove(),_}function _toRange(a){function c(a){"tr"==K(a.node).name&&(a.node=a.node.cells[a.offset],a.offset=0)}var h,_;if(_IERANGE){if(a.item)return h=_getDoc(a.item(0)),_=new KRange(h),_.selectNode(a.item(0)),_;h=a.parentElement().ownerDocument;var g=_getStartEnd(a,!0),v=_getStartEnd(a,!1);return c(g),c(v),_=new KRange(h),_.setStart(g.node,g.offset),_.setEnd(v.node,v.offset),_}var b=a.startContainer;return h=b.ownerDocument||b,_=new KRange(h),_.setStart(b,a.startOffset),_.setEnd(a.endContainer,a.endOffset),_}function KRange(a){this.init(a)}function _range(a){return a.nodeName?new KRange(a):a.constructor===KRange?a:_toRange(a)}function _nativeCommand(a,c,h){try{a.execCommand(c,!1,h)}catch(e){}}function _nativeCommandValue(a,c){var h="";try{h=a.queryCommandValue(c)}catch(e){}return"string"!=typeof h&&(h=""),h}function _getSel(a){var c=_getWin(a);return _IERANGE?a.selection:c.getSelection()}function _getRng(a){var c,h=_getSel(a);try{c=h.rangeCount>0?h.getRangeAt(0):h.createRange()}catch(e){}return!_IERANGE||c&&(c.item||c.parentElement().ownerDocument===a)?c:null}function _singleKeyMap(a){var c,h,_={};return _each(a,function(a,g){c=a.split(",");for(var i=0,v=c.length;v>i;i++)h=c[i],_[h]=g}),_}function _hasAttrOrCss(a,c){return _hasAttrOrCssByKey(a,c,"*")||_hasAttrOrCssByKey(a,c)}function _hasAttrOrCssByKey(a,c,h){if(h=h||a.name,1!==a.type)return!1;var _=_singleKeyMap(c);if(!_[h])return!1;for(var g=_[h].split(","),i=0,v=g.length;v>i;i++){var b=g[i];if("*"===b)return!0;var y=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(b),k=y[1]?"css":"attr";b=y[2];var C=y[3]||"";if(""===C&&""!==a[k](b))return!0;if(""!==C&&a[k](b)===C)return!0}return!1}function _removeAttrOrCss(a,c){1==a.type&&(_removeAttrOrCssByKey(a,c,"*"),_removeAttrOrCssByKey(a,c))}function _removeAttrOrCssByKey(a,c,h){if(h=h||a.name,1===a.type){var _=_singleKeyMap(c);if(_[h]){for(var g=_[h].split(","),v=!1,i=0,b=g.length;b>i;i++){var y=g[i];if("*"===y){v=!0;break}var k=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(y);y=k[2],k[1]?(y=_toCamel(y),a[0].style[y]&&(a[0].style[y]="")):a.removeAttr(y)}v&&a.remove(!0)}}}function _getInnerNode(a){for(var c=a;c.first();)c=c.first();return c}function _isEmptyNode(a){return 1!=a.type||a.isSingle()?!1:""===a.html().replace(/<[^>]+>/g,"")}function _mergeWrapper(a,c){a=a.clone(!0);for(var h=_getInnerNode(a),_=a,g=!1;c;){for(;_;)_.name===c.name&&(_mergeAttrs(_,c.attr(),c.css()),g=!0),_=_.first();g||h.append(c.clone(!1)),g=!1,c=c.first()}return a}function _wrapNode(a,c){if(c=c.clone(!0),3==a.type)return _getInnerNode(c).append(a.clone(!1)),a.replaceWith(c),c;for(var h,_=a;(h=a.first())&&1==h.children().length;)a=h;h=a.first();for(var g=a.doc.createDocumentFragment();h;)g.appendChild(h[0]),h=h.next();return c=_mergeWrapper(_,c),g.firstChild&&_getInnerNode(c).append(g),_.replaceWith(c),c}function _mergeAttrs(a,c,h){_each(c,function(c,h){"style"!==c&&a.attr(c,h)}),_each(h,function(c,h){a.css(c,h)})}function _inPreElement(a){for(;a&&"body"!=a.name;){if(_PRE_TAG_MAP[a.name]||"div"==a.name&&a.hasClass("ke-script"))return!0;a=a.parent()}return!1}function KCmd(a){this.init(a)}function _cmd(a){if(a.nodeName){var c=_getDoc(a);a=_range(c).selectNodeContents(c.body).collapse(!1)}return new KCmd(a)}function _drag(a){var c=a.moveEl,h=a.moveFn,_=a.clickEl||c,g=a.beforeDrag,v=a.iframeFix===undefined?!0:a.iframeFix,b=[document];v&&K("iframe").each(function(){var a=_formatUrl(this.src||"","absolute");if(!/^https?:\/\//.test(a)){var c;try{c=_iframeDoc(this)}catch(e){}if(c){var h=K(this).pos();K(c).data("pos-x",h.x),K(c).data("pos-y",h.y),b.push(c)}}}),_.mousedown(function(e){function a(e){e.preventDefault();var a=K(_getDoc(e.target)),c=_round((a.data("pos-x")||0)+e.pageX-w),g=_round((a.data("pos-y")||0)+e.pageY-A);h.call(_,x,C,E,T,c,g)}function v(e){e.preventDefault()}function y(e){e.preventDefault(),K(b).unbind("mousemove",a).unbind("mouseup",y).unbind("selectstart",v),k.releaseCapture&&k.releaseCapture()}e.stopPropagation();var k=_.get(),x=_removeUnit(c.css("left")),C=_removeUnit(c.css("top")),E=c.width(),T=c.height(),w=e.pageX,A=e.pageY;g&&g(),K(b).mousemove(a).mouseup(y).bind("selectstart",v),k.setCapture&&k.setCapture()})}function KWidget(a){this.init(a)}function _widget(a){return new KWidget(a)}function _iframeDoc(a){return a=_get(a),a.contentDocument||a.contentWindow.document}function _getInitHtml(a,c,h,_){var g=[""===_direction?"<html>":'<html dir="'+_direction+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrap: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","img.ke-flash {","	border:1px solid #AAA;","	background-image:url("+a+"common/flash.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-rm {","	border:1px solid #AAA;","	background-image:url("+a+"common/rm.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-media {","	border:1px solid #AAA;","	background-image:url("+a+"common/media.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-anchor {","	border:1px dashed #666;","	width:16px;","	height:16px;","}",".ke-script, .ke-noscript, .ke-display-none {","	display:none;","	font-size:0;","	width:0;","	height:0;","}",".ke-pagebreak {","	border:1px dotted #AAA;","	font-size:0;","	height:2px;","}","</style>"];return _isArray(h)||(h=[h]),_each(h,function(i,a){a&&g.push('<link href="'+a+'" rel="stylesheet" />')}),_&&g.push("<style>"+_+"</style>"),g.push("</head><body "+(c?'class="'+c+'"':"")+"></body></html>"),g.join("\n")}function _elementVal(a,c){if(a.hasVal()){if(c===undefined){var h=a.val();return h=h.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"")}return a.val(c)}return a.html(c)}function KEdit(a){this.init(a)}function _edit(a){return new KEdit(a)}function _selectToolbar(a,c){var h=this,_=h.get(a);if(_){if(_.hasClass("ke-disabled"))return;c(_)}}function KToolbar(a){this.init(a)}function _toolbar(a){return new KToolbar(a)}function KMenu(a){this.init(a)}function _menu(a){return new KMenu(a)}function KColorPicker(a){this.init(a)}function _colorpicker(a){return new KColorPicker(a)}function KUploadButton(a){this.init(a)}function _uploadbutton(a){return new KUploadButton(a)}function _createButton(a){a=a||{};var c=a.name||"",h=K('<span class="ke-button-common ke-button-outer" title="'+c+'"></span>'),_=K('<input class="ke-button-common ke-button" type="button" value="'+c+'" />');return a.click&&_.click(a.click),h.append(_),h}function KDialog(a){this.init(a)}function _dialog(a){return new KDialog(a)}function _tabs(a){var c=_widget(a),h=c.remove,_=a.afterSelect,g=c.div,v=[];g.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()});var ul=K('<ul class="ke-tabs-ul ke-clearfix"></ul>');return g.append(ul),c.add=function(a){var c=K('<li class="ke-tabs-li">'+a.title+"</li>");c.data("tab",a),v.push(c),ul.append(c)},c.selectedIndex=0,c.select=function(a){c.selectedIndex=a,_each(v,function(i,h){h.unbind(),i===a?(h.addClass("ke-tabs-li-selected"),K(h.data("tab").panel).show("")):(h.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){K(this).addClass("ke-tabs-li-on")}).mouseout(function(){K(this).removeClass("ke-tabs-li-on")}).click(function(){c.select(i)}),K(h.data("tab").panel).hide())}),_&&_.call(c,a)},c.remove=function(){_each(v,function(){this.remove()}),ul.remove(),h.call(c)},c}function _loadScript(a,c){var h=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),_=document.createElement("script");h.appendChild(_),_.src=a,_.charset="utf-8",_.onload=_.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState||(c&&c(),_.onload=_.onreadystatechange=null,h.removeChild(_))}}function _chopQuery(a){var c=a.indexOf("?");return c>0?a.substr(0,c):a}function _loadStyle(a){for(var c=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),h=document.createElement("link"),_=_chopQuery(_formatUrl(a,"absolute")),g=K('link[rel="stylesheet"]',c),i=0,v=g.length;v>i;i++)if(_chopQuery(_formatUrl(g[i].href,"absolute"))===_)return;c.appendChild(h),h.href=a,h.rel="stylesheet"}function _ajax(a,c,h,_,g){h=h||"GET",g=g||"json";var v=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(v.open(h,a,!0),v.onreadystatechange=function(){if(4==v.readyState&&200==v.status&&c){var a=_trim(v.responseText);"json"==g&&(a=_json(a)),c(a)}},"POST"==h){var b=[];_each(_,function(a,c){b.push(encodeURIComponent(a)+"="+encodeURIComponent(c))});try{v.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){}v.send(b.join("&"))}else v.send(null)}function _plugin(a,c){return a===undefined?_plugins:c?void(_plugins[a]=c):_plugins[a]}function _parseLangKey(a){var c,h="core";return(c=/^(\w+)\.(\w+)$/.exec(a))&&(h=c[1],a=c[2]),{ns:h,key:a}}function _lang(a,c){if(c=c===undefined?K.options.langType:c,"string"==typeof a){if(!_language[c])return"no language";var h=a.length-1;if("."===a.substr(h))return _language[c][a.substr(0,h)];var _=_parseLangKey(a);return _language[c][_.ns][_.key]}_each(a,function(a,h){var _=_parseLangKey(a);_language[c]||(_language[c]={}),_language[c][_.ns]||(_language[c][_.ns]={}),_language[c][_.ns][_.key]=h})}function _getImageFromRange(a,c){if(!a.collapsed){a=a.cloneRange().up();var h=a.startContainer,_=a.startOffset;if(_WEBKIT||a.isControl()){var g=K(h.childNodes[_]);if(g&&"img"==g.name)return c(g)?g:void 0}}}function _bindContextmenuEvent(){var a=this,c=a.edit.doc;K(c).contextmenu(function(e){if(a.menu&&a.hideMenu(),!a.useContextmenu)return void e.preventDefault();if(0!==a._contextmenus.length){var c=0,h=[];for(_each(a._contextmenus,function(){return"-"==this.title?void h.push(this):void(this.cond&&this.cond()&&(h.push(this),this.width&&this.width>c&&(c=this.width)))});h.length>0&&"-"==h[0].title;)h.shift();for(;h.length>0&&"-"==h[h.length-1].title;)h.pop();var _=null;if(_each(h,function(i){"-"==this.title&&"-"==_.title&&delete h[i],_=this}),h.length>0){e.preventDefault();var g=K(a.edit.iframe).pos(),v=_menu({x:g.x+e.clientX,y:g.y+e.clientY,width:c,css:{visibility:"hidden"},shadowMode:a.shadowMode});_each(h,function(){this.title&&v.addItem(this)});var b=_docElement(v.doc),y=v.div.height();e.clientY+y>=b.clientHeight-100&&v.pos(v.x,_removeUnit(v.y)-y),v.div.css("visibility","visible"),a.menu=v}}})}function _bindNewlineEvent(){function a(a){for(var c=K(a.commonAncestor());c&&(1!=c.type||c.isStyle());)c=c.parent();return c.name}var c=this,h=c.edit.doc,_=c.newlineTag;if(!(_IE&&"br"!==_||_GECKO&&3>_V&&"p"!==_||_OPERA&&9>_V)){var g=_toMap("h1,h2,h3,h4,h5,h6,pre,li"),v=_toMap("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote");K(h).keydown(function(e){if(!(13!=e.which||e.shiftKey||e.ctrlKey||e.altKey)){c.cmd.selection();var b=a(c.cmd.range);if("marquee"!=b&&"select"!=b)return"br"!==_||g[b]?void(v[b]||_nativeCommand(h,"formatblock","<p>")):(e.preventDefault(),void c.insertHtml("<br />"+(_IE&&9>_V?"":"​")))}}),K(h).keyup(function(e){if(!(13!=e.which||e.shiftKey||e.ctrlKey||e.altKey)&&"br"!=_){if(_GECKO){var g=c.cmd.commonAncestor("p"),b=c.cmd.commonAncestor("a");return void(b&&""==b.text()&&(b.remove(!0),c.cmd.range.selectNodeContents(g[0]).collapse(!0),c.cmd.select()))}c.cmd.selection();var y=a(c.cmd.range);if("marquee"!=y&&"select"!=y){v[y]||_nativeCommand(h,"formatblock","<p>");var k=c.cmd.commonAncestor("div");if(k){for(var p=K("<p></p>"),C=k[0].firstChild;C;){var E=C.nextSibling;p.append(C),C=E}k.before(p),k.remove(),c.cmd.range.selectNodeContents(p[0]),c.cmd.select()}}}})}}function _bindTabEvent(){var a=this,c=a.edit.doc;K(c).keydown(function(e){if(9==e.which){if(e.preventDefault(),a.afterTab)return void a.afterTab.call(a,e);var h=a.cmd,_=h.range;_.shrink(),_.collapsed&&1==_.startContainer.nodeType&&(_.insertNode(K("@&nbsp;",c)[0]),h.select()),a.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function _bindFocusEvent(){var a=this;K(a.edit.textarea[0],a.edit.win).focus(function(e){a.afterFocus&&a.afterFocus.call(a,e)}).blur(function(e){a.afterBlur&&a.afterBlur.call(a,e)})}function _removeBookmarkTag(a){return _trim(a.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/gi,""))}function _removeTempTag(a){return a.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/gi,"")}function _addBookmarkToStack(a,c){if(0===a.length)return void a.push(c);var h=a[a.length-1];_removeBookmarkTag(c.html)!==_removeBookmarkTag(h.html)&&a.push(c)}function _undoToRedo(a,c){var h,_,g=this,v=g.edit,b=v.doc.body;if(0===a.length)return g;v.designMode?(h=g.cmd.range,_=h.createBookmark(!0),_.html=b.innerHTML):_={html:b.innerHTML},_addBookmarkToStack(c,_);var y=a.pop();
return _removeBookmarkTag(_.html)===_removeBookmarkTag(y.html)&&a.length>0&&(y=a.pop()),v.designMode?(v.html(y.html),y.start&&(h.moveToBookmark(y),g.select())):K(b).html(_removeBookmarkTag(y.html)),g}function KEditor(a){function c(a,c){KEditor.prototype[a]===undefined&&(h[a]=c),h.options[a]=c}var h=this;h.options={},_each(a,function(h){c(h,a[h])}),_each(K.options,function(a,_){h[a]===undefined&&c(a,_)});var _=K(h.srcElement||"<textarea/>");h.width||(h.width=_[0].style.width||_.width()),h.height||(h.height=_[0].style.height||_.height()),c("width",_undef(h.width,h.minWidth)),c("height",_undef(h.height,h.minHeight)),c("width",_addUnit(h.width)),c("height",_addUnit(h.height)),_MOBILE&&(!_IOS||534>_V)&&(h.designMode=!1),h.srcElement=_,h.initContent="",h.plugin={},h.isCreated=!1,h._handlers={},h._contextmenus=[],h._undoStack=[],h._redoStack=[],h._firstAddBookmark=!0,h.menu=h.contextmenu=null,h.dialogs=[]}function _editor(a){return new KEditor(a)}function _create(a,c){function h(a){return _each(_plugins,function(c,h){_isFunction(h)&&h.call(a,KindEditor)}),a.create()}if(c=c||{},c.basePath=_undef(c.basePath,K.basePath),c.themesPath=_undef(c.themesPath,c.basePath+"themes/"),c.langPath=_undef(c.langPath,c.basePath+"lang/"),c.pluginsPath=_undef(c.pluginsPath,c.basePath+"plugins/"),_undef(c.loadStyleMode,K.options.loadStyleMode)){var _=_undef(c.themeType,K.options.themeType);_loadStyle(c.themesPath+"default/default.css"),_loadStyle(c.themesPath+_+"/"+_+".css")}var g=K(a);if(g&&0!==g.length){if(g.length>1)return g.each(function(){_create(this,c)}),_instances[0];c.srcElement=g[0];var v=new KEditor(c);return _instances.push(v),_language[v.langType]?h(v):(_loadScript(v.langPath+v.langType+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){h(v)}),v)}}function _eachEditor(a,c){K(a).each(function(i,a){K.each(_instances,function(h,_){return _&&_.srcElement[0]==a?(c.call(_,h),!1):void 0})})}if(!window.KindEditor){window.console||(window.console={}),console.log||(console.log=function(){});var _VERSION="4.1.10 (2013-11-23)",_ua=navigator.userAgent.toLowerCase(),_IE=_ua.indexOf("msie")>-1&&-1==_ua.indexOf("opera"),_NEWIE=-1==_ua.indexOf("msie")&&_ua.indexOf("trident")>-1,_GECKO=_ua.indexOf("gecko")>-1&&-1==_ua.indexOf("khtml"),_WEBKIT=_ua.indexOf("applewebkit")>-1,_OPERA=_ua.indexOf("opera")>-1,_MOBILE=_ua.indexOf("mobile")>-1,_IOS=/ipad|iphone|ipod/.test(_ua),_QUIRKS="CSS1Compat"!=document.compatMode,_IERANGE=!window.getSelection,_matches=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(_ua),_V=_matches?_matches[1]:"0",_TIME=(new Date).getTime(),_round=Math.round,K={DEBUG:!1,VERSION:_VERSION,IE:_IE,GECKO:_GECKO,WEBKIT:_WEBKIT,OPERA:_OPERA,V:_V,TIME:_TIME,each:_each,isArray:_isArray,isFunction:_isFunction,inArray:_inArray,inString:_inString,trim:_trim,addUnit:_addUnit,removeUnit:_removeUnit,escape:_escape,unescape:_unescape,toCamel:_toCamel,toHex:_toHex,toMap:_toMap,toArray:_toArray,undef:_undef,invalidUrl:_invalidUrl,addParam:_addParam,extend:_extend,json:_json},_INLINE_TAG_MAP=_toMap("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),_BLOCK_TAG_MAP=_toMap("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),_SINGLE_TAG_MAP=_toMap("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),_STYLE_TAG_MAP=_toMap("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),_CONTROL_TAG_MAP=_toMap("img,table,input,textarea,button"),_PRE_TAG_MAP=_toMap("pre,style,script"),_NOSPLIT_TAG_MAP=_toMap("html,head,body,td,tr,table,ol,ul,li"),_AUTOCLOSE_TAG_MAP=_toMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),_FILL_ATTR_MAP=_toMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),_VALUE_TAG_MAP=_toMap("input,button,textarea,select");K.basePath=_getBasePath(),K.options={designMode:!0,fullscreenMode:!1,filterMode:!0,wellFormatMode:!0,shadowMode:!0,loadStyleMode:!0,basePath:K.basePath,themesPath:K.basePath+"themes/",langPath:K.basePath+"lang/",pluginsPath:K.basePath+"plugins/",themeType:"default",langType:"zh_CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:!0,fullscreenShortcut:!1,bodyClass:"ke-content",indentChar:"	",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,zIndex:811213,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'};var _useCapture=!1,_INPUT_KEY_MAP=_toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),_CURSORMOVE_KEY_MAP=_toMap("33..40"),_CHANGE_KEY_MAP={};_each(_INPUT_KEY_MAP,function(a,c){_CHANGE_KEY_MAP[a]=c}),_each(_CURSORMOVE_KEY_MAP,function(a,c){_CHANGE_KEY_MAP[a]=c});var _EVENT_PROPS="altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which".split(",");_extend(KEvent,{init:function(a,c){var h=this,_=a.ownerDocument||a.document||a;if(h.event=c,_each(_EVENT_PROPS,function(a,_){h[_]=c[_]}),h.target||(h.target=h.srcElement||_),3===h.target.nodeType&&(h.target=h.target.parentNode),!h.relatedTarget&&h.fromElement&&(h.relatedTarget=h.fromElement===h.target?h.toElement:h.fromElement),null==h.pageX&&null!=h.clientX){var d=_.documentElement,g=_.body;h.pageX=h.clientX+(d&&d.scrollLeft||g&&g.scrollLeft||0)-(d&&d.clientLeft||g&&g.clientLeft||0),h.pageY=h.clientY+(d&&d.scrollTop||g&&g.scrollTop||0)-(d&&d.clientTop||g&&g.clientTop||0)}switch(!h.which&&(h.charCode||0===h.charCode?h.charCode:h.keyCode)&&(h.which=h.charCode||h.keyCode),!h.metaKey&&h.ctrlKey&&(h.metaKey=h.ctrlKey),h.which||h.button===undefined||(h.which=1&h.button?1:2&h.button?3:4&h.button?2:0),h.which){case 186:h.which=59;break;case 187:case 107:case 43:h.which=61;break;case 189:case 45:h.which=109;break;case 42:h.which=106;break;case 47:h.which=111;break;case 78:h.which=110}h.which>=96&&h.which<=105&&(h.which-=48)},preventDefault:function(){var a=this.event;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.event;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},stop:function(){this.preventDefault(),this.stopPropagation()}});var _eventExpendo="kindeditor_"+_TIME,_eventId=0,_eventData={},_readyFinished=!1;_IE&&window.attachEvent("onunload",function(){_each(_eventData,function(a,c){c.el&&_unbind(c.el)})}),K.ctrl=_ctrl,K.ready=_ready,K.formatUrl=_formatUrl,K.formatHtml=_formatHtml,K.getCssList=_getCssList,K.getAttrList=_getAttrList,K.mediaType=_mediaType,K.mediaAttrs=_mediaAttrs,K.mediaEmbed=_mediaEmbed,K.mediaImg=_mediaImg,K.clearMsWord=_clearMsWord,K.tmpl=_tmpl;var _getSetAttrDiv=document.createElement("div");_getSetAttrDiv.setAttribute("className","t");var _GET_SET_ATTRIBUTE="t"!==_getSetAttrDiv.className;K.query=_query,K.queryAll=_queryAll,_extend(KNode,{init:function(a){var c=this;a=_isArray(a)?a:[a];for(var h=0,i=0,_=a.length;_>i;i++)a[i]&&(c[i]=a[i].constructor===KNode?a[i][0]:a[i],h++);c.length=h,c.doc=_getDoc(c[0]),c.name=_getNodeName(c[0]),c.type=c.length>0?c[0].nodeType:null,c.win=_getWin(c[0])},each:function(a){for(var c=this,i=0;i<c.length;i++)if(a.call(c[i],i,c[i])===!1)return c;return c},bind:function(a,c){return this.each(function(){_bind(this,a,c)}),this},unbind:function(a,c){return this.each(function(){_unbind(this,a,c)}),this},fire:function(a){return this.length<1?this:(_fire(this[0],a),this)},hasAttr:function(a){return this.length<1?!1:!!_getAttr(this[0],a)},attr:function(a,c){var h=this;return a===undefined?_getAttrList(h.outer()):"object"==typeof a?(_each(a,function(a,c){h.attr(a,c)}),h):c===undefined?(c=h.length<1?null:_getAttr(h[0],a),null===c?"":c):(h.each(function(){_setAttr(this,a,c)}),h)},removeAttr:function(a){return this.each(function(){_removeAttr(this,a)}),this},get:function(i){return this.length<1?null:this[i||0]},eq:function(i){return this.length<1?null:this[i]?new KNode(this[i]):null},hasClass:function(a){return this.length<1?!1:_hasClass(this[0],a)},addClass:function(a){return this.each(function(){_hasClass(this,a)||(this.className=_trim(this.className+" "+a))}),this},removeClass:function(a){return this.each(function(){_hasClass(this,a)&&(this.className=_trim(this.className.replace(new RegExp("(^|\\s)"+a+"(\\s|$)")," ")))}),this},html:function(a){var c=this;return a===undefined?c.length<1||1!=c.type?"":_formatHtml(c[0].innerHTML):(c.each(function(){_setHtml(this,a)}),c)},text:function(){var a=this;return a.length<1?"":_IE?a[0].innerText:a[0].textContent},hasVal:function(){return this.length<1?!1:_hasVal(this[0])},val:function(a){var c=this;return a===undefined?c.length<1?"":c.hasVal()?c[0].value:c.attr("value"):(c.each(function(){_hasVal(this)?this.value=a:_setAttr(this,"value",a)}),c)},css:function(a,c){var h=this;return a===undefined?_getCssList(h.attr("style")):"object"==typeof a?(_each(a,function(a,c){h.css(a,c)}),h):c===undefined?h.length<1?"":h[0].style[_toCamel(a)]||_computedCss(h[0],a)||"":(h.each(function(){this.style[_toCamel(a)]=c}),h)},width:function(a){var c=this;return a===undefined?c.length<1?0:c[0].offsetWidth:c.css("width",_addUnit(a))},height:function(a){var c=this;return a===undefined?c.length<1?0:c[0].offsetHeight:c.css("height",_addUnit(a))},opacity:function(a){return this.each(function(){this.style.opacity===undefined?this.style.filter=1==a?"":"alpha(opacity="+100*a+")":this.style.opacity=1==a?"":a}),this},data:function(a,c){var h=this;return a="kindeditor_data_"+a,c===undefined?h.length<1?null:h[0][a]:(this.each(function(){this[a]=c}),h)},pos:function(){var a=this,c=a[0],x=0,h=0;if(c)if(c.getBoundingClientRect){var _=c.getBoundingClientRect(),g=_getScrollPos(a.doc);x=_.left+g.x,h=_.top+g.y}else for(;c;)x+=c.offsetLeft,h+=c.offsetTop,c=c.offsetParent;return{x:_round(x),y:_round(h)}},clone:function(a){return new KNode(this.length<1?[]:this[0].cloneNode(a))},append:function(a){return this.each(function(){this.appendChild&&this.appendChild(_get(a))}),this},appendTo:function(a){return this.each(function(){_get(a).appendChild(this)}),this},before:function(a){return this.each(function(){this.parentNode.insertBefore(_get(a),this)}),this},after:function(a){return this.each(function(){this.nextSibling?this.parentNode.insertBefore(_get(a),this.nextSibling):this.parentNode.appendChild(_get(a))}),this},replaceWith:function(a){var c=[];return this.each(function(i,h){_unbind(h);var _=_get(a);h.parentNode.replaceChild(_,h),c.push(_)}),K(c)},empty:function(){var a=this;return a.each(function(i,a){for(var c=a.firstChild;c;){if(!a.parentNode)return;var h=c.nextSibling;c.parentNode.removeChild(c),c=h}}),a},remove:function(a){var c=this;return c.each(function(i,h){if(h.parentNode){if(_unbind(h),a)for(var _=h.firstChild;_;){var g=_.nextSibling;h.parentNode.insertBefore(_,h),_=g}h.parentNode.removeChild(h),delete c[i]}}),c.length=0,c},show:function(a){var c=this;return a===undefined&&(a=c._originDisplay||""),"none"!=c.css("display")?c:c.css("display",a)},hide:function(){var a=this;return a.length<1?a:(a._originDisplay=a[0].style.display,a.css("display","none"))},outer:function(){var a=this;if(a.length<1)return"";var c,h=a.doc.createElement("div");return h.appendChild(a[0].cloneNode(!0)),c=_formatHtml(h.innerHTML),h=null,c},isSingle:function(){return!!_SINGLE_TAG_MAP[this.name]},isInline:function(){return!!_INLINE_TAG_MAP[this.name]},isBlock:function(){return!!_BLOCK_TAG_MAP[this.name]},isStyle:function(){return!!_STYLE_TAG_MAP[this.name]},isControl:function(){return!!_CONTROL_TAG_MAP[this.name]},contains:function(a){return this.length<1?!1:_contains(this[0],_get(a))},parent:function(){if(this.length<1)return null;var a=this[0].parentNode;return a?new KNode(a):null},children:function(){if(this.length<1)return new KNode([]);for(var a=[],c=this[0].firstChild;c;)(3!=c.nodeType||""!==_trim(c.nodeValue))&&a.push(c),c=c.nextSibling;return new KNode(a)},first:function(){var a=this.children();return a.length>0?a.eq(0):null},last:function(){var a=this.children();return a.length>0?a.eq(a.length-1):null},index:function(){if(this.length<1)return-1;for(var i=-1,a=this[0];a;)i++,a=a.previousSibling;return i},prev:function(){if(this.length<1)return null;var a=this[0].previousSibling;return a?new KNode(a):null},next:function(){if(this.length<1)return null;var a=this[0].nextSibling;return a?new KNode(a):null},scan:function(a,c){function h(_){for(var n=c?_.firstChild:_.lastChild;n;){var g=c?n.nextSibling:n.previousSibling;if(a(n)===!1)return!1;if(h(n)===!1)return!1;n=g}}if(!(this.length<1))return c=c===undefined?!0:c,h(this[0]),this}}),_each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),function(i,a){KNode.prototype[a]=function(c){return c?this.bind(a,c):this.fire(a)}});var _K=K;K=function(a,c){function h(a){return a[0]||(a=[]),new KNode(a)}if(a!==undefined&&null!==a){if("string"==typeof a){c&&(c=_get(c));var _=a.length;if("@"===a.charAt(0)&&(a=a.substr(1)),a.length!==_||/<.+>/.test(a)){var g=c?c.ownerDocument||c:document,v=g.createElement("div"),b=[];v.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+a;for(var i=0,y=v.childNodes.length;y>i;i++){var k=v.childNodes[i];"__kindeditor_temp_tag__"!=k.id&&b.push(k)}return h(b)}return h(_queryAll(a,c))}return a&&a.constructor===KNode?a:(a.toArray&&(a=a.toArray()),h(_isArray(a)?a:_toArray(arguments)))}},_each(_K,function(a,c){K[a]=c}),K.NodeClass=KNode,window.KindEditor=K;var _START_TO_START=0,_START_TO_END=1,_END_TO_END=2,_END_TO_START=3,_BOOKMARK_ID=0;_extend(KRange,{init:function(a){var c=this;c.startContainer=a,c.startOffset=0,c.endContainer=a,c.endOffset=0,c.collapsed=!0,c.doc=a},commonAncestor:function(){function a(a){for(var c=[];a;)c.push(a),a=a.parentNode;return c}for(var c,h,_=a(this.startContainer),g=a(this.endContainer),i=0,v=_.length,b=g.length;++i&&(c=_[v-i],h=g[b-i],c&&h&&c===h););return _[v-i+1]},setStart:function(a,c){var h=this,_=h.doc;return h.startContainer=a,h.startOffset=c,h.endContainer===_&&(h.endContainer=a,h.endOffset=c),_updateCollapsed(this)},setEnd:function(a,c){var h=this,_=h.doc;return h.endContainer=a,h.endOffset=c,h.startContainer===_&&(h.startContainer=a,h.startOffset=c),_updateCollapsed(this)},setStartBefore:function(a){return this.setStart(a.parentNode||this.doc,K(a).index())},setStartAfter:function(a){return this.setStart(a.parentNode||this.doc,K(a).index()+1)},setEndBefore:function(a){return this.setEnd(a.parentNode||this.doc,K(a).index())},setEndAfter:function(a){return this.setEnd(a.parentNode||this.doc,K(a).index()+1)},selectNode:function(a){return this.setStartBefore(a).setEndAfter(a)},selectNodeContents:function(a){var c=K(a);if(3==c.type||c.isSingle())return this.selectNode(a);var h=c.children();return h.length>0?this.setStartBefore(h[0]).setEndAfter(h[h.length-1]):this.setStart(a,0).setEnd(a,0)},collapse:function(a){return a?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(a,c){var h=this.get(),_=c.get();if(!_IERANGE)return h.compareBoundaryPoints(a,_);var g={};g[_START_TO_START]="StartToStart",g[_START_TO_END]="EndToStart",g[_END_TO_END]="EndToEnd",g[_END_TO_START]="StartToEnd";var v=h.compareEndPoints(g[a],_);if(0!==v)return v;var b,y,k,C,E;if((a===_START_TO_START||a===_END_TO_START)&&(b=this.startContainer,C=this.startOffset),(a===_START_TO_END||a===_END_TO_END)&&(b=this.endContainer,C=this.endOffset),(a===_START_TO_START||a===_START_TO_END)&&(y=c.startContainer,E=c.startOffset),(a===_END_TO_END||a===_END_TO_START)&&(y=c.endContainer,E=c.endOffset),b===y){var T=C-E;return T>0?1:0>T?-1:0}for(k=y;k&&k.parentNode!==b;)k=k.parentNode;if(k)return K(k).index()>=C?-1:1;for(k=b;k&&k.parentNode!==y;)k=k.parentNode;return k?K(k).index()>=E?1:-1:(k=K(y).next(),k&&k.contains(b)?1:(k=K(b).next(),k&&k.contains(y)?-1:void 0))},cloneRange:function(){return new KRange(this.doc).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var a=this.get(),c=_IERANGE?a.text:a.toString();return c.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return _copyAndDelete(this,!0,!1)},deleteContents:function(){return _copyAndDelete(this,!1,!0)},extractContents:function(){return _copyAndDelete(this,!0,!0)},insertNode:function(a){var c,h,_,g=this,v=g.startContainer,b=g.startOffset,y=g.endContainer,k=g.endOffset,C=1;return"#document-fragment"===a.nodeName.toLowerCase()&&(c=a.firstChild,h=a.lastChild,C=a.childNodes.length),1==v.nodeType?(_=v.childNodes[b],_?(v.insertBefore(a,_),v===y&&(k+=C)):v.appendChild(a)):3==v.nodeType&&(0===b?(v.parentNode.insertBefore(a,v),v.parentNode===y&&(k+=C)):b>=v.nodeValue.length?v.nextSibling?v.parentNode.insertBefore(a,v.nextSibling):v.parentNode.appendChild(a):(_=b>0?v.splitText(b):v,v.parentNode.insertBefore(a,_),v===y&&(y=_,k-=b))),c?g.setStartBefore(c).setEndAfter(h):g.selectNode(a),g.compareBoundaryPoints(_END_TO_END,g.cloneRange().setEnd(y,k))>=1?g:g.setEnd(y,k)},surroundContents:function(a){return a.appendChild(this.extractContents()),this.insertNode(a).selectNode(a)},isControl:function(){var a=this,c=a.startContainer,h=a.startOffset,_=a.endContainer,g=a.endOffset;return 1==c.nodeType&&c===_&&h+1===g&&K(c.childNodes[h]).isControl()},get:function(a){var c,h=this,_=h.doc;if(!_IERANGE){c=_.createRange();try{c.setStart(h.startContainer,h.startOffset),c.setEnd(h.endContainer,h.endOffset)}catch(e){}return c}if(a&&h.isControl())return c=_.body.createControlRange(),c.addElement(h.startContainer.childNodes[h.startOffset]),c;var g=h.cloneRange().down();return c=_.body.createTextRange(),c.setEndPoint("StartToStart",_getEndRange(g.startContainer,g.startOffset)),c.setEndPoint("EndToStart",_getEndRange(g.endContainer,g.endOffset)),c},html:function(){return K(this.cloneContents()).outer()},down:function(){function a(a,h,_){if(1==a.nodeType){var g=K(a).children();if(0!==g.length){var v,b,y,k;h>0&&(v=g.eq(h-1)),h<g.length&&(b=g.eq(h)),v&&3==v.type&&(y=v[0],k=y.nodeValue.length),b&&3==b.type&&(y=b[0],k=0),y&&(_?c.setStart(y,k):c.setEnd(y,k))}}}var c=this;return a(c.startContainer,c.startOffset,!0),a(c.endContainer,c.endOffset,!1),c},up:function(){function a(a,h,_){3==a.nodeType&&(0===h?_?c.setStartBefore(a):c.setEndBefore(a):h==a.nodeValue.length&&(_?c.setStartAfter(a):c.setEndAfter(a)))}var c=this;return a(c.startContainer,c.startOffset,!0),a(c.endContainer,c.endOffset,!1),c},enlarge:function(a){function c(c,_,g){var v,b=K(c);if(!(3==b.type||_NOSPLIT_TAG_MAP[b.name]||!a&&b.isBlock()))if(0===_){for(;!b.prev()&&(v=b.parent(),v&&!_NOSPLIT_TAG_MAP[v.name]&&(a||!v.isBlock()));)b=v;g?h.setStartBefore(b[0]):h.setEndBefore(b[0])}else if(_==b.children().length){for(;!b.next()&&(v=b.parent(),v&&!_NOSPLIT_TAG_MAP[v.name]&&(a||!v.isBlock()));)b=v;g?h.setStartAfter(b[0]):h.setEndAfter(b[0])}}var h=this;return h.up(),c(h.startContainer,h.startOffset,!0),c(h.endContainer,h.endOffset,!1),h},shrink:function(){for(var a,c=this,h=c.collapsed;1==c.startContainer.nodeType&&(a=c.startContainer.childNodes[c.startOffset])&&1==a.nodeType&&!K(a).isSingle();)c.setStart(a,0);if(h)return c.collapse(h);for(;1==c.endContainer.nodeType&&c.endOffset>0&&(a=c.endContainer.childNodes[c.endOffset-1])&&1==a.nodeType&&!K(a).isSingle();)c.setEnd(a,a.childNodes.length);return c},createBookmark:function(a){var c,h=this,_=h.doc,g=K('<span style="display:none;"></span>',_)[0];return g.id="__kindeditor_bookmark_start_"+_BOOKMARK_ID++ +"__",h.collapsed||(c=g.cloneNode(!0),c.id="__kindeditor_bookmark_end_"+_BOOKMARK_ID++ +"__"),c&&h.cloneRange().collapse(!1).insertNode(c).setEndBefore(c),h.insertNode(g).setStartAfter(g),{start:a?"#"+g.id:g,end:c?a?"#"+c.id:c:null}},moveToBookmark:function(a){var c=this,h=c.doc,_=K(a.start,h),g=a.end?K(a.end,h):null;return!_||_.length<1?c:(c.setStartBefore(_[0]),_.remove(),g&&g.length>0?(c.setEndBefore(g[0]),g.remove()):c.collapse(!0),c)},dump:function(){}}),K.RangeClass=KRange,K.range=_range,K.START_TO_START=_START_TO_START,K.START_TO_END=_START_TO_END,K.END_TO_END=_END_TO_END,K.END_TO_START=_END_TO_START,_extend(KCmd,{init:function(a){var c=this,h=a.doc;c.doc=h,c.win=_getWin(h),c.sel=_getSel(h),c.range=a},selection:function(a){var c=this,h=c.doc,_=_getRng(h);return c.sel=_getSel(h),_?(c.range=_range(_),"html"==K(c.range.startContainer).name&&c.range.selectNodeContents(h.body).collapse(!1),c):(a&&c.range.selectNodeContents(h.body).collapse(!1),c)},select:function(a){a=_undef(a,!0);var c,h=this,_=h.sel,g=h.range.cloneRange().shrink(),v=g.startContainer,b=g.startOffset,y=(g.endContainer,g.endOffset,_getDoc(v)),k=h.win,C=!1;if(a&&1==v.nodeType&&g.collapsed){if(_IERANGE){var E=K("<span>&nbsp;</span>",y);g.insertNode(E[0]),c=y.body.createTextRange();try{c.moveToElementText(E[0])}catch(ex){}return c.collapse(!1),c.select(),E.remove(),k.focus(),h}if(_WEBKIT){var T=v.childNodes;(K(v).isInline()||b>0&&K(T[b-1]).isInline()||T[b]&&K(T[b]).isInline())&&(g.insertNode(y.createTextNode("​")),C=!0)}}if(_IERANGE)try{c=g.get(!0),c.select()}catch(e){}else if(C&&g.collapse(!1),c=g.get(!0),_.removeAllRanges(),_.addRange(c),y!==document){var w=K(c.endContainer).pos();k.scrollTo(w.x,w.y)}return k.focus(),h},wrap:function(a){var c,h=this,_=h.doc,g=h.range;if(c=K(a,_),g.collapsed)return g.shrink(),g.insertNode(c[0]).selectNodeContents(c[0]),h;if(c.isBlock()){for(var v=c.clone(!0),b=v;b.first();)b=b.first();return b.append(g.extractContents()),g.insertNode(v[0]).selectNode(v[0]),h}g.enlarge();var y=g.createBookmark(),k=g.commonAncestor(),C=!1;return K(k).scan(function(a){if(!C&&a==y.start)return void(C=!0);if(C){if(a==y.end)return!1;var h=K(a);if(_inPreElement(h))return;if(3==h.type&&_trim(a.nodeValue).length>0){for(var _;(_=h.parent())&&_.isStyle()&&1==_.children().length;)h=_;_wrapNode(h,c)}}}),g.moveToBookmark(y),h},split:function(a,c){for(var h,_=this.range,g=_.doc,v=_.cloneRange().collapse(a),b=v.startContainer,y=v.startOffset,k=3==b.nodeType?b.parentNode:b,C=!1;k&&k.parentNode;){if(h=K(k),c){if(!h.isStyle())break;if(!_hasAttrOrCss(h,c))break}else if(_NOSPLIT_TAG_MAP[h.name])break;C=!0,k=k.parentNode}if(C){var E=g.createElement("span");_.cloneRange().collapse(!a).insertNode(E),a?v.setStartBefore(k.firstChild).setEnd(b,y):v.setStart(b,y).setEndAfter(k.lastChild);var T=v.extractContents(),w=T.firstChild,A=T.lastChild;a?(v.insertNode(T),_.setStartAfter(A).setEndBefore(E)):(k.appendChild(T),_.setStartBefore(E).setEndBefore(w));var N=E.parentNode;if(N==_.endContainer){var S=K(E).prev(),M=K(E).next();S&&M&&3==S.type&&3==M.type?_.setEnd(S[0],S[0].nodeValue.length):a||_.setEnd(_.endContainer,_.endOffset-1)}N.removeChild(E)}return this},remove:function(a){var c=this,h=c.doc,_=c.range;if(_.enlarge(),0===_.startOffset){for(var g,v=K(_.startContainer);(g=v.parent())&&g.isStyle()&&1==g.children().length;)v=g;_.setStart(v[0],0),v=K(_.startContainer),v.isBlock()&&_removeAttrOrCss(v,a);var b=v.parent();b&&b.isBlock()&&_removeAttrOrCss(b,a)}var y,k;if(_.collapsed){if(c.split(!0,a),y=_.startContainer,k=_.startOffset,k>0){var C=K(y.childNodes[k-1]);C&&_isEmptyNode(C)&&(C.remove(),_.setStart(y,k-1))}var E=K(y.childNodes[k]);return E&&_isEmptyNode(E)&&E.remove(),_isEmptyNode(y)&&(_.startBefore(y),y.remove()),_.collapse(!0),c}c.split(!0,a),c.split(!1,a);var T=h.createElement("span"),w=h.createElement("span");_.cloneRange().collapse(!1).insertNode(w),_.cloneRange().collapse(!0).insertNode(T);var A=[],N=!1;K(_.commonAncestor()).scan(function(a){return N||a!=T?a==w?!1:void(N&&A.push(a)):void(N=!0)}),K(T).remove(),K(w).remove(),y=_.startContainer,k=_.startOffset;var S=_.endContainer,M=_.endOffset;if(k>0){var I=K(y.childNodes[k-1]);I&&_isEmptyNode(I)&&(I.remove(),_.setStart(y,k-1),y==S&&_.setEnd(S,M-1));var O=K(y.childNodes[k]);O&&_isEmptyNode(O)&&(O.remove(),y==S&&_.setEnd(S,M-1))}var D=K(S.childNodes[_.endOffset]);D&&_isEmptyNode(D)&&D.remove();var P=_.createBookmark(!0);return _each(A,function(i,c){_removeAttrOrCss(K(c),a)}),_.moveToBookmark(P),c},commonNode:function(a){function c(c){for(var h=c,_=c;_;){if(_hasAttrOrCss(K(_),a))return K(_);_=_.parentNode}for(;h&&(h=h.lastChild);)if(_hasAttrOrCss(K(h),a))return K(h);return null}var h=this.range,_=h.endContainer,g=h.endOffset,v=3==_.nodeType||0===g?_:_.childNodes[g-1],b=c(v);if(b)return b;if(1==v.nodeType||3==_.nodeType&&0===g){var y=K(v).prev();if(y)return c(y)}return null},commonAncestor:function(a){function c(c){for(;c;){if(1==c.nodeType&&c.tagName.toLowerCase()===a)return c;c=c.parentNode}return null}var h=this.range,_=h.startContainer,g=h.startOffset,v=h.endContainer,b=h.endOffset,y=3==_.nodeType||0===g?_:_.childNodes[g-1],k=3==v.nodeType||0===b?v:v.childNodes[b-1],C=c(y),E=c(k);return C&&E&&C===E?K(C):null},state:function(a){var c=this,h=c.doc,_=!1;try{_=h.queryCommandState(a)}catch(e){}return _},val:function(a){function c(a){return a.toLowerCase()}{var h=this,_=h.doc;h.range}a=c(a);var g,v="";return"fontfamily"===a||"fontname"===a?(v=_nativeCommandValue(_,"fontname"),v=v.replace(/['"]/g,""),c(v)):"formatblock"===a?(v=_nativeCommandValue(_,a),""===v&&(g=h.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"}),g&&(v=g.name)),"Normal"===v&&(v="p"),c(v)):"fontsize"===a?(g=h.commonNode({"*":".font-size"}),g&&(v=g.css("font-size")),c(v)):"forecolor"===a?(g=h.commonNode({"*":".color"}),g&&(v=g.css("color")),v=_toHex(v),""===v&&(v="default"),c(v)):"hilitecolor"===a?(g=h.commonNode({"*":".background-color"}),g&&(v=g.css("background-color")),v=_toHex(v),""===v&&(v="default"),c(v)):v},toggle:function(a,c){var h=this;return h.commonNode(c)?h.remove(c):h.wrap(a),h.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(a){return this.wrap('<span style="color:'+a+';"></span>').select()},hilitecolor:function(a){return this.wrap('<span style="background-color:'+a+';"></span>').select()},fontsize:function(a){return this.wrap('<span style="font-size:'+a+';"></span>').select()},fontname:function(a){return this.fontfamily(a)},fontfamily:function(a){return this.wrap('<span style="font-family:'+a+';"></span>').select()},removeformat:function(){var a={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},c=_STYLE_TAG_MAP;return _each(c,function(c){a[c]="*"}),this.remove(a),this.select()},inserthtml:function(a,c){function h(a,c){c='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+c;var h=a.get();h.item?h.item(0).outerHTML=c:h.pasteHTML(c);var _=a.doc.getElementById("__kindeditor_temp_tag__");_.parentNode.removeChild(_);var v=_toRange(h);a.setEnd(v.endContainer,v.endOffset),a.collapse(!1),g.select(!1)}function _(a,c){var h=a.doc,_=h.createDocumentFragment();K("@"+c,h).each(function(){_.appendChild(this)}),a.deleteContents(),a.insertNode(_),a.collapse(!1),g.select(!1)}var g=this,v=g.range;if(""===a)return g;if(_IERANGE&&c){try{h(v,a)}catch(e){_(v,a)}return g}return _(v,a),g},hr:function(){return this.inserthtml("<hr />")},print:function(){return this.win.print(),this},insertimage:function(a,c,h,_,g,v){c=_undef(c,""),g=_undef(g,0);var b='<img src="'+_escape(a)+'" data-ke-src="'+_escape(a)+'" ';return h&&(b+='width="'+_escape(h)+'" '),_&&(b+='height="'+_escape(_)+'" '),c&&(b+='title="'+_escape(c)+'" '),v&&(b+='align="'+_escape(v)+'" '),b+='alt="'+_escape(c)+'" ',b+="/>",this.inserthtml(b)},createlink:function(a,c){function h(a,c,h){K(a).attr("href",c).attr("data-ke-src",c),h?K(a).attr("target",h):K(a).removeAttr("target")}var _=this,g=_.doc,v=_.range;_.select();var b=_.commonNode({a:"*"});b&&!v.isControl()&&(v.selectNode(b.get()),_.select());var y='<a href="'+_escape(a)+'" data-ke-src="'+_escape(a)+'" ';if(c&&(y+=' target="'+_escape(c)+'"'),v.collapsed)return y+=">"+_escape(a)+"</a>",_.inserthtml(y);if(v.isControl()){var k=K(v.startContainer.childNodes[v.startOffset]);return y+="></a>",k.after(K(y,g)),k.next().append(k),v.selectNode(k[0]),_.select()}var C=v.startContainer,E=v.startOffset,T=v.endContainer,w=v.endOffset;if(1==C.nodeType&&C===T&&E+1===w){var A=C.childNodes[E];if("a"==A.nodeName.toLowerCase())return h(A,a,c),_}return _nativeCommand(g,"createlink","__kindeditor_temp_url__"),K('a[href="__kindeditor_temp_url__"]',g).each(function(){h(this,a,c)}),_},unlink:function(){var a=this,c=a.doc,h=a.range;if(a.select(),h.collapsed){var _=a.commonNode({a:"*"});if(_&&(h.selectNode(_.get()),a.select()),_nativeCommand(c,"unlink",null),_WEBKIT&&"img"===K(h.startContainer).name){var g=K(h.startContainer).parent();
"a"===g.name&&g.remove(!0)}}else _nativeCommand(c,"unlink",null);return a}}),_each("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript".split(","),function(i,a){KCmd.prototype[a]=function(c){var h=this;return h.select(),_nativeCommand(h.doc,a,c),_IERANGE&&_inArray(a,"justifyleft,justifycenter,justifyright,justifyfull".split(","))>=0&&h.selection(),(!_IERANGE||_inArray(a,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0)&&h.selection(),h}}),_each("cut,copy,paste".split(","),function(i,a){KCmd.prototype[a]=function(){var c=this;if(!c.doc.queryCommandSupported(a))throw"not supported";return c.select(),_nativeCommand(c.doc,a,null),c}}),K.CmdClass=KCmd,K.cmd=_cmd,_extend(KWidget,{init:function(a){var c=this;if(c.name=a.name||"",c.doc=a.doc||document,c.win=_getWin(c.doc),c.x=_addUnit(a.x),c.y=_addUnit(a.y),c.z=a.z,c.width=_addUnit(a.width),c.height=_addUnit(a.height),c.div=K('<div style="display:block;"></div>'),c.options=a,c._alignEl=a.alignEl,c.width&&c.div.css("width",c.width),c.height&&c.div.css("height",c.height),c.z&&c.div.css({position:"absolute",left:c.x,top:c.y,"z-index":c.z}),!c.z||c.x!==undefined&&c.y!==undefined||c.autoPos(c.width,c.height),a.cls&&c.div.addClass(a.cls),a.shadowMode&&c.div.addClass("ke-shadow"),a.css&&c.div.css(a.css),a.src?K(a.src).replaceWith(c.div):K(c.doc.body).append(c.div),a.html&&c.div.html(a.html),a.autoScroll)if(_IE&&7>_V||_QUIRKS){var h=_getScrollPos();K(c.win).bind("scroll",function(){var a=_getScrollPos(),_=a.x-h.x,g=a.y-h.y;c.pos(_removeUnit(c.x)+_,_removeUnit(c.y)+g,!1)})}else c.div.css("position","fixed")},pos:function(x,a,c){var h=this;return c=_undef(c,!0),null!==x&&(x=0>x?0:_addUnit(x),h.div.css("left",x),c&&(h.x=x)),null!==a&&(a=0>a?0:_addUnit(a),h.div.css("top",a),c&&(h.y=a)),h},autoPos:function(a,c){var h=this,_=_removeUnit(a)||0,g=_removeUnit(c)||0,v=_getScrollPos();if(h._alignEl){var b=K(h._alignEl),k=b.pos(),C=_round(b[0].clientWidth/2-_/2),E=_round(b[0].clientHeight/2-g/2);x=0>C?k.x:k.x+C,y=0>E?k.y:k.y+E}else{var T=_docElement(h.doc);x=_round(v.x+(T.clientWidth-_)/2),y=_round(v.y+(T.clientHeight-g)/2)}return _IE&&7>_V||_QUIRKS||(x-=v.x,y-=v.y),h.pos(x,y)},remove:function(){var a=this;return(_IE&&7>_V||_QUIRKS)&&K(a.win).unbind("scroll"),a.div.remove(),_each(a,function(i){a[i]=null}),this},show:function(){return this.div.show(),this},hide:function(){return this.div.hide(),this},draggable:function(a){var c=this;return a=a||{},a.moveEl=c.div,a.moveFn=function(x,a,h,_,g,v){(x+=g)<0&&(x=0),(a+=v)<0&&(a=0),c.pos(x,a)},_drag(a),c}}),K.WidgetClass=KWidget,K.widget=_widget;var html,_direction="";(html=document.getElementsByTagName("html"))&&(_direction=html[0].dir),_extend(KEdit,KWidget,{init:function(a){function c(){var c=_iframeDoc(h.iframe);c.open(),y&&(c.domain=document.domain),c.write(_getInitHtml(_,g,v,b)),c.close(),h.win=h.iframe[0].contentWindow,h.doc=c;var k=_cmd(c);h.afterChange(function(){k.selection()}),_WEBKIT&&K(c).click(function(e){"img"===K(e.target).name&&(k.selection(!0),k.range.selectNode(e.target),k.select())}),_IE&&(h._mousedownHandler=function(){var a=k.range.cloneRange();a.shrink(),a.isControl()&&h.blur()},K(document).mousedown(h._mousedownHandler),K(c).keydown(function(e){if(8==e.which){k.selection();var a=k.range;a.isControl()&&(a.collapse(!0),K(a.startContainer.childNodes[a.startOffset]).remove(),e.preventDefault())}})),h.cmd=k,h.html(_elementVal(h.srcElement)),_IE?(c.body.disabled=!0,c.body.contentEditable=!0,c.body.removeAttribute("disabled")):c.designMode="on",a.afterCreate&&a.afterCreate.call(h)}var h=this;KEdit.parent.init.call(h,a),h.srcElement=K(a.srcElement),h.div.addClass("ke-edit"),h.designMode=_undef(a.designMode,!0),h.beforeGetHtml=a.beforeGetHtml,h.beforeSetHtml=a.beforeSetHtml,h.afterSetHtml=a.afterSetHtml;var _=_undef(a.themesPath,""),g=a.bodyClass,v=a.cssPath,b=a.cssData,y="res:"!=location.protocol&&location.host.replace(/:\d+/,"")!==document.domain,k="document.open();"+(y?'document.domain="'+document.domain+'";':"")+"document.close();",C=_IE?' src="javascript:void(function(){'+encodeURIComponent(k)+'}())"':"";h.iframe=K('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+C+"></iframe>").css("width","100%"),h.textarea=K('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%"),h.tabIndex=isNaN(parseInt(a.tabIndex,10))?h.srcElement.attr("tabindex"):parseInt(a.tabIndex,10),h.iframe.attr("tabindex",h.tabIndex),h.textarea.attr("tabindex",h.tabIndex),h.width&&h.setWidth(h.width),h.height&&h.setHeight(h.height),h.designMode?h.textarea.hide():h.iframe.hide(),y&&h.iframe.bind("load",function(){h.iframe.unbind("load"),_IE?c():setTimeout(c,0)}),h.div.append(h.iframe),h.div.append(h.textarea),h.srcElement.hide(),!y&&c()},setWidth:function(a){var c=this;return a=_addUnit(a),c.width=a,c.div.css("width",a),c},setHeight:function(a){var c=this;return a=_addUnit(a),c.height=a,c.div.css("height",a),c.iframe.css("height",a),(_IE&&8>_V||_QUIRKS)&&(a=_addUnit(_removeUnit(a)-2)),c.textarea.css("height",a),c},remove:function(){var a=this,c=a.doc;K(c.body).unbind(),K(c).unbind(),K(a.win).unbind(),a._mousedownHandler&&K(document).unbind("mousedown",a._mousedownHandler),_elementVal(a.srcElement,a.html()),a.srcElement.show(),c.write(""),a.iframe.unbind(),a.textarea.unbind(),KEdit.parent.remove.call(a)},html:function(a,c){var h=this,_=h.doc;if(h.designMode){var g=_.body;return a===undefined?(a=c?"<!doctype html><html>"+g.parentNode.innerHTML+"</html>":g.innerHTML,h.beforeGetHtml&&(a=h.beforeGetHtml(a)),_GECKO&&"<br />"==a&&(a=""),a):(h.beforeSetHtml&&(a=h.beforeSetHtml(a)),_IE&&_V>=9&&(a=a.replace(/(<.*?checked=")checked(".*>)/gi,"$1$2")),K(g).html(a),h.afterSetHtml&&h.afterSetHtml(),h)}return a===undefined?h.textarea.val():(h.textarea.val(a),h)},design:function(a){var c,h=this;return(a===undefined?!h.designMode:a)?h.designMode||(c=h.html(),h.designMode=!0,h.html(c),h.textarea.hide(),h.iframe.show()):h.designMode&&(c=h.html(),h.designMode=!1,h.html(c),h.iframe.hide(),h.textarea.show()),h.focus()},focus:function(){var a=this;return a.designMode?a.win.focus():a.textarea[0].focus(),a},blur:function(){var a=this;if(_IE){var c=K('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',a.div);a.div.append(c),c[0].focus(),c.remove()}else a.designMode?a.win.blur():a.textarea[0].blur();return a},afterChange:function(a){function c(e){setTimeout(function(){a(e)},1)}var h=this,_=h.doc,g=_.body;return K(_).keyup(function(e){e.ctrlKey||e.altKey||!_CHANGE_KEY_MAP[e.which]||a(e)}),K(_).mouseup(a).contextmenu(a),K(h.win).blur(a),K(g).bind("paste",c),K(g).bind("cut",c),h}}),K.EditClass=KEdit,K.edit=_edit,K.iframeDoc=_iframeDoc,_extend(KToolbar,KWidget,{init:function(a){function c(a){var c=K(a);return c.hasClass("ke-outline")?c:c.hasClass("ke-toolbar-icon")?c.parent():void 0}function h(e,a){var h=c(e.target);if(h){if(h.hasClass("ke-disabled"))return;if(h.hasClass("ke-selected"))return;h[a]("ke-on")}}var _=this;KToolbar.parent.init.call(_,a),_.disableMode=_undef(a.disableMode,!1),_.noDisableItemMap=_toMap(_undef(a.noDisableItems,[])),_._itemMap={},_.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()}).attr("unselectable","on"),_.div.mouseover(function(e){h(e,"addClass")}).mouseout(function(e){h(e,"removeClass")}).click(function(e){var a=c(e.target);if(a){if(a.hasClass("ke-disabled"))return;_.options.click.call(this,e,a.attr("data-name"))}})},get:function(a){return this._itemMap[a]?this._itemMap[a]:this._itemMap[a]=K("span.ke-icon-"+a,this.div).parent()},select:function(a){return _selectToolbar.call(this,a,function(a){a.addClass("ke-selected")}),self},unselect:function(a){return _selectToolbar.call(this,a,function(a){a.removeClass("ke-selected").removeClass("ke-on")}),self},enable:function(a){var c=this,h=a.get?a:c.get(a);return h&&(h.removeClass("ke-disabled"),h.opacity(1)),c},disable:function(a){var c=this,h=a.get?a:c.get(a);return h&&(h.removeClass("ke-selected").addClass("ke-disabled"),h.opacity(.5)),c},disableAll:function(a,c){var h=this,_=h.noDisableItemMap;return c&&(_=_toMap(c)),(a===undefined?!h.disableMode:a)?(K("span.ke-outline",h.div).each(function(){var a=K(this),c=a[0].getAttribute("data-name",2);_[c]||h.disable(a)}),h.disableMode=!0):(K("span.ke-outline",h.div).each(function(){var a=K(this),c=a[0].getAttribute("data-name",2);_[c]||h.enable(a)}),h.disableMode=!1),h}}),K.ToolbarClass=KToolbar,K.toolbar=_toolbar,_extend(KMenu,KWidget,{init:function(a){var c=this;a.z=a.z||811213,KMenu.parent.init.call(c,a),c.centerLineMode=_undef(a.centerLineMode,!0),c.div.addClass("ke-menu").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on")},addItem:function(a){var c=this;if("-"===a.title)return void c.div.append(K('<div class="ke-menu-separator"></div>'));var h=K('<div class="ke-menu-item" unselectable="on"></div>'),_=K('<div class="ke-inline-block ke-menu-item-left"></div>'),g=K('<div class="ke-inline-block ke-menu-item-right"></div>'),v=_addUnit(a.height),b=_undef(a.iconClass,"");c.div.append(h),v&&(h.css("height",v),g.css("line-height",v));var y;return c.centerLineMode&&(y=K('<div class="ke-inline-block ke-menu-item-center"></div>'),v&&y.css("height",v)),h.mouseover(function(){K(this).addClass("ke-menu-item-on"),y&&y.addClass("ke-menu-item-center-on")}).mouseout(function(){K(this).removeClass("ke-menu-item-on"),y&&y.removeClass("ke-menu-item-center-on")}).click(function(e){a.click.call(K(this)),e.stopPropagation()}).append(_),y&&h.append(y),h.append(g),a.checked&&(b="ke-icon-checked"),""!==b&&_.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+b+'"></span>'),g.html(a.title),c},remove:function(){var a=this;return a.options.beforeRemove&&a.options.beforeRemove.call(a),K(".ke-menu-item",a.div[0]).unbind(),KMenu.parent.remove.call(a),a}}),K.MenuClass=KMenu,K.menu=_menu,_extend(KColorPicker,KWidget,{init:function(a){var c=this;a.z=a.z||811213,KColorPicker.parent.init.call(c,a);var h=a.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]];c.selectedColor=(a.selectedColor||"").toLowerCase(),c._cells=[],c.div.addClass("ke-colorpicker").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on");var _=c.doc.createElement("table");c.div.append(_),_.className="ke-colorpicker-table",_.cellPadding=0,_.cellSpacing=0,_.border=0;var g=_.insertRow(0),v=g.insertCell(0);v.colSpan=h[0].length,c._addAttr(v,"","ke-colorpicker-cell-top");for(var i=0;i<h.length;i++){g=_.insertRow(i+1);for(var b=0;b<h[i].length;b++)v=g.insertCell(b),c._addAttr(v,h[i][b],"ke-colorpicker-cell")}},_addAttr:function(a,c,h){var _=this;a=K(a).addClass(h),_.selectedColor===c.toLowerCase()&&a.addClass("ke-colorpicker-cell-selected"),a.attr("title",c||_.options.noColor),a.mouseover(function(){K(this).addClass("ke-colorpicker-cell-on")}),a.mouseout(function(){K(this).removeClass("ke-colorpicker-cell-on")}),a.click(function(e){e.stop(),_.options.click.call(K(this),c)}),c?a.append(K('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",c)):a.html(_.options.noColor),K(a).attr("unselectable","on"),_._cells.push(a)},remove:function(){var a=this;return _each(a._cells,function(){this.unbind()}),KColorPicker.parent.remove.call(a),a}}),K.ColorPickerClass=KColorPicker,K.colorpicker=_colorpicker,_extend(KUploadButton,{init:function(a){var c=this,h=K(a.button),_=a.fieldName||"file",g=a.url||"",v=h.val(),b=a.extraParams||{},y=h[0].className||"",k=a.target||"kindeditor_upload_iframe_"+(new Date).getTime();a.afterError=a.afterError||function(a){alert(a)};var C=[];for(var E in b)C.push('<input type="hidden" name="'+E+'" value="'+b[E]+'" />');var T=['<div class="ke-inline-block '+y+'">',a.target?"":'<iframe name="'+k+'" style="display:none;"></iframe>',a.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+k+'" action="'+g+'">','<span class="ke-button-common">',C.join(""),'<input type="button" class="ke-button-common ke-button" value="'+v+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+_+'" tabindex="-1" />',a.form?"</div>":"</form>","</div>"].join(""),w=K(T,h.doc);h.hide(),h.before(w),c.div=w,c.button=h,c.iframe=a.target?K('iframe[name="'+k+'"]'):K("iframe",w),c.form=a.form?K(a.form):K("form",w),c.fileBox=K(".ke-upload-file",w);var A=a.width||K(".ke-button-common",w).width();K(".ke-upload-area",w).width(A),c.options=a},submit:function(){var a=this,c=a.iframe;return c.bind("load",function(){c.unbind();var h=document.createElement("form");a.fileBox.before(h),K(h).append(a.fileBox),h.reset(),K(h).remove(!0);var _,g=K.iframeDoc(c),v=g.getElementsByTagName("pre")[0],b="";b=v?v.innerHTML:g.body.innerHTML,b=_unescape(b),c[0].src="javascript:false";try{_=K.json(b)}catch(e){a.options.afterError.call(a,"<!doctype html><html>"+g.body.parentNode.innerHTML+"</html>")}_&&a.options.afterUpload.call(a,_)}),a.form[0].submit(),a},remove:function(){var a=this;return a.fileBox&&a.fileBox.unbind(),a.iframe.remove(),a.div.remove(),a.button.show(),a}}),K.UploadButtonClass=KUploadButton,K.uploadbutton=_uploadbutton,_extend(KDialog,KWidget,{init:function(a){var c=this,h=_undef(a.shadowMode,!0);a.z=a.z||811213,a.shadowMode=!1,a.autoScroll=_undef(a.autoScroll,!0),KDialog.parent.init.call(c,a);var _=a.title,g=K(a.body,c.doc),v=a.previewBtn,b=a.yesBtn,y=a.noBtn,k=a.closeBtn,C=_undef(a.showMask,!0);c.div.addClass("ke-dialog").bind("click,mousedown",function(e){e.stopPropagation()});var E=K('<div class="ke-dialog-content"></div>').appendTo(c.div);_IE&&7>_V?c.iframeMask=K('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(c.div):h&&K('<div class="ke-dialog-shadow"></div>').appendTo(c.div);var T=K('<div class="ke-dialog-header"></div>');E.append(T),T.html(_),c.closeIcon=K('<span class="ke-dialog-icon-close" title="'+k.name+'"></span>').click(k.click),T.append(c.closeIcon),c.draggable({clickEl:T,beforeDrag:a.beforeDrag});var w=K('<div class="ke-dialog-body"></div>');E.append(w),w.append(g);var A=K('<div class="ke-dialog-footer"></div>');if((v||b||y)&&E.append(A),_each([{btn:v,name:"preview"},{btn:b,name:"yes"},{btn:y,name:"no"}],function(){if(this.btn){var a=_createButton(this.btn);a.addClass("ke-dialog-"+this.name),A.append(a)}}),c.height&&w.height(_removeUnit(c.height)-T.height()-A.height()),c.div.width(c.div.width()),c.div.height(c.div.height()),c.mask=null,C){var N=_docElement(c.doc),S=Math.max(N.scrollWidth,N.clientWidth),M=Math.max(N.scrollHeight,N.clientHeight);c.mask=_widget({x:0,y:0,z:c.z-1,cls:"ke-dialog-mask",width:S,height:M})}c.autoPos(c.div.width(),c.div.height()),c.footerDiv=A,c.bodyDiv=w,c.headerDiv=T,c.isLoading=!1},setMaskIndex:function(a){var c=this;c.mask.div.css("z-index",a)},showLoading:function(a){a=_undef(a,"");var c=this,h=c.bodyDiv;return c.loading=K('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(h.height()/3)+'px;">'+a+"</div></div>").width(h.width()).height(h.height()).css("top",c.headerDiv.height()+"px"),h.css("visibility","hidden").after(c.loading),c.isLoading=!0,c},hideLoading:function(){return this.loading&&this.loading.remove(),this.bodyDiv.css("visibility","visible"),this.isLoading=!1,this},remove:function(){var a=this;return a.options.beforeRemove&&a.options.beforeRemove.call(a),a.mask&&a.mask.remove(),a.iframeMask&&a.iframeMask.remove(),a.closeIcon.unbind(),K("input",a.div).unbind(),K("button",a.div).unbind(),a.footerDiv.unbind(),a.bodyDiv.unbind(),a.headerDiv.unbind(),K("iframe",a.div).each(function(){K(this).remove()}),KDialog.parent.remove.call(a),a}}),K.DialogClass=KDialog,K.dialog=_dialog,K.tabs=_tabs,K.loadScript=_loadScript,K.loadStyle=_loadStyle,K.ajax=_ajax;var _plugins={},_language={};KEditor.prototype={lang:function(a){return _lang(a,this.langType)},loadPlugin:function(a,c){var h=this;return _plugins[a]?_isFunction(_plugins[a])?(_plugins[a].call(h,KindEditor),c&&c.call(h),h):(setTimeout(function(){h.loadPlugin(a,c)},100),h):(_plugins[a]="loading",_loadScript(h.pluginsPath+a+"/"+a+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){setTimeout(function(){_plugins[a]&&h.loadPlugin(a,c)},0)}),h)},handler:function(a,c){var h=this;return h._handlers[a]||(h._handlers[a]=[]),_isFunction(c)?(h._handlers[a].push(c),h):(_each(h._handlers[a],function(){c=this.call(h,c)}),c)},clickToolbar:function(a,c){var h=this,_="clickToolbar"+a;return c===undefined?h._handlers[_]?h.handler(_):(h.loadPlugin(a,function(){h.handler(_)}),h):h.handler(_,c)},updateState:function(){var a=this;return _each("justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,subscript,superscript,bold,italic,underline,strikethrough".split(","),function(i,c){a.cmd.state(c)?a.toolbar.select(c):a.toolbar.unselect(c)}),a},addContextmenu:function(a){return this._contextmenus.push(a),this},afterCreate:function(a){return this.handler("afterCreate",a)},beforeRemove:function(a){return this.handler("beforeRemove",a)},beforeGetHtml:function(a){return this.handler("beforeGetHtml",a)},beforeSetHtml:function(a){return this.handler("beforeSetHtml",a)},afterSetHtml:function(a){return this.handler("afterSetHtml",a)},create:function(){function a(){return 0===k.height()?void setTimeout(a,100):void c.resize(_,g,!1)}var c=this,h=c.fullscreenMode;if(c.isCreated)return c;if(c.srcElement.data("kindeditor"))return c;c.srcElement.data("kindeditor","true"),_docElement().style.overflow=h?"hidden":"";var _=h?_docElement().clientWidth+"px":c.width,g=h?_docElement().clientHeight+"px":c.height;(_IE&&8>_V||_QUIRKS)&&(g=_addUnit(_removeUnit(g)+2));var v=c.container=K(c.layout);h?K(document.body).append(v):c.srcElement.before(v);var b=K(".toolbar",v),y=K(".edit",v),k=c.statusbar=K(".statusbar",v);v.removeClass("container").addClass("ke-container ke-container-"+c.themeType).css("width",_),h?(v.css({position:"absolute",left:0,top:0,"z-index":811211}),_GECKO||(c._scrollPos=_getScrollPos()),window.scrollTo(0,0),K(document.body).css({height:"1px",overflow:"hidden"}),K(document.body.parentNode).css("overflow","hidden"),c._fullscreenExecuted=!0):(c._fullscreenExecuted&&(K(document.body).css({height:"",overflow:""}),K(document.body.parentNode).css("overflow","")),c._scrollPos&&window.scrollTo(c._scrollPos.x,c._scrollPos.y));var C=[];K.each(c.items,function(i,a){"|"==a?C.push('<span class="ke-inline-block ke-separator"></span>'):"/"==a?C.push('<div class="ke-hr"></div>'):(C.push('<span class="ke-outline" data-name="'+a+'" title="'+c.lang(a)+'" unselectable="on">'),C.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+a+'" unselectable="on"></span></span>'))});var E=c.toolbar=_toolbar({src:b,html:C.join(""),noDisableItems:c.noDisableItems,click:function(e,a){if(e.stop(),c.menu){var h=c.menu.name;if(c.hideMenu(),h===a)return}c.clickToolbar(a)}}),T=_removeUnit(g)-E.div.height(),w=c.edit=_edit({height:T>0&&_removeUnit(g)>c.minHeight?T:c.minHeight,src:y,srcElement:c.srcElement,designMode:c.designMode,themesPath:c.themesPath,bodyClass:c.bodyClass,cssPath:c.cssPath,cssData:c.cssData,beforeGetHtml:function(a){return a=c.beforeGetHtml(a),a=_removeBookmarkTag(_removeTempTag(a)),_formatHtml(a,c.filterMode?c.htmlTags:null,c.urlType,c.wellFormatMode,c.indentChar)},beforeSetHtml:function(a){return a=_formatHtml(a,c.filterMode?c.htmlTags:null,"",!1),c.beforeSetHtml(a)},afterSetHtml:function(){c.edit=w=this,c.afterSetHtml()},afterCreate:function(){if(c.edit=w=this,c.cmd=w.cmd,c._docMousedownFn=function(){c.menu&&c.hideMenu()},K(w.doc,document).mousedown(c._docMousedownFn),_bindContextmenuEvent.call(c),_bindNewlineEvent.call(c),_bindTabEvent.call(c),_bindFocusEvent.call(c),w.afterChange(function(){w.designMode&&(c.updateState(),c.addBookmark(),c.options.afterChange&&c.options.afterChange.call(c))}),w.textarea.keyup(function(e){e.ctrlKey||e.altKey||!_INPUT_KEY_MAP[e.which]||c.options.afterChange&&c.options.afterChange.call(c)}),c.readonlyMode&&c.readonly(),c.isCreated=!0,""===c.initContent&&(c.initContent=c.html()),c._undoStack.length>0){var a=c._undoStack.pop();a.start&&(c.html(a.html),w.cmd.range.moveToBookmark(a),c.select())}c.afterCreate(),c.options.afterCreate&&c.options.afterCreate.call(c)}});return k.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>'),c._fullscreenResizeHandler&&(K(window).unbind("resize",c._fullscreenResizeHandler),c._fullscreenResizeHandler=null),a(),h?(c._fullscreenResizeHandler=function(){c.isCreated&&c.resize(_docElement().clientWidth,_docElement().clientHeight,!1)},K(window).bind("resize",c._fullscreenResizeHandler),E.select("fullscreen"),k.first().css("visibility","hidden"),k.last().css("visibility","hidden")):(_GECKO&&K(window).bind("scroll",function(){c._scrollPos=_getScrollPos()}),c.resizeType>0?_drag({moveEl:v,clickEl:k,moveFn:function(x,a,h,_,g,v){_+=v,c.resize(null,_)}}):k.first().css("visibility","hidden"),2===c.resizeType?_drag({moveEl:v,clickEl:k.last(),moveFn:function(x,a,h,_,g,v){h+=g,_+=v,c.resize(h,_)}}):k.last().css("visibility","hidden")),c},remove:function(){var a=this;return a.isCreated?(a.beforeRemove(),a.srcElement.data("kindeditor",""),a.menu&&a.hideMenu(),_each(a.dialogs,function(){a.hideDialog()}),K(document).unbind("mousedown",a._docMousedownFn),a.toolbar.remove(),a.edit.remove(),a.statusbar.last().unbind(),a.statusbar.unbind(),a.container.remove(),a.container=a.toolbar=a.edit=a.menu=null,a.dialogs=[],a.isCreated=!1,a):a},resize:function(a,c,h){var _=this;return h=_undef(h,!0),a&&(/%/.test(a)||(a=_removeUnit(a),a=a<_.minWidth?_.minWidth:a),_.container.css("width",_addUnit(a)),h&&(_.width=_addUnit(a))),c&&(c=_removeUnit(c),editHeight=_removeUnit(c)-_.toolbar.div.height()-_.statusbar.height(),editHeight=editHeight<_.minHeight?_.minHeight:editHeight,_.edit.setHeight(editHeight),h&&(_.height=_addUnit(c))),_},select:function(){return this.isCreated&&this.cmd.select(),this},html:function(a){var c=this;return a===undefined?c.isCreated?c.edit.html():_elementVal(c.srcElement):(c.isCreated?c.edit.html(a):_elementVal(c.srcElement,a),c.isCreated&&c.cmd.selection(),c)},fullHtml:function(){return this.isCreated?this.edit.html(undefined,!0):""},text:function(a){var c=this;return a===undefined?_trim(c.html().replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," ")):c.html(_escape(a))},isEmpty:function(){return""===_trim(this.text().replace(/\r\n|\n|\r/,""))},isDirty:function(){return _trim(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==_trim(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){var a=this.isCreated?this.cmd.range.html():"";return a=_removeBookmarkTag(_removeTempTag(a))},count:function(a){var c=this;return a=(a||"html").toLowerCase(),"html"===a?c.html().length:"text"===a?c.text().replace(/<(?:img|embed).*?>/gi,"K").replace(/\r\n|\n|\r/g,"").length:0},exec:function(a){a=a.toLowerCase();var c=this,h=c.cmd,_=_inArray(a,"selectall,copy,paste,print".split(","))<0;return _&&c.addBookmark(!1),h[a].apply(h,_toArray(arguments,1)),_&&(c.updateState(),c.addBookmark(!1),c.options.afterChange&&c.options.afterChange.call(c)),c},insertHtml:function(a,c){return this.isCreated?(a=this.beforeSetHtml(a),this.exec("inserthtml",a,c),this):this},appendHtml:function(a){if(this.html(this.html()+a),this.isCreated){var c=this.cmd;c.range.selectNodeContents(c.doc.body).collapse(!1),c.select()}return this},sync:function(){return _elementVal(this.srcElement,this.html()),this},focus:function(){return this.isCreated?this.edit.focus():this.srcElement[0].focus(),this},blur:function(){return this.isCreated?this.edit.blur():this.srcElement[0].blur(),this},addBookmark:function(a){a=_undef(a,!0);var c,h=this,_=h.edit,g=_.doc.body,v=_removeTempTag(g.innerHTML);if(a&&h._undoStack.length>0){var b=h._undoStack[h._undoStack.length-1];if(Math.abs(v.length-_removeBookmarkTag(b.html).length)<h.minChangeSize)return h}if(_.designMode&&!h._firstAddBookmark){var y=h.cmd.range;c=y.createBookmark(!0),c.html=_removeTempTag(g.innerHTML),y.moveToBookmark(c)}else c={html:v};return h._firstAddBookmark=!1,_addBookmarkToStack(h._undoStack,c),h},undo:function(){return _undoToRedo.call(this,this._undoStack,this._redoStack)},redo:function(){return _undoToRedo.call(this,this._redoStack,this._undoStack)},fullscreen:function(a){return this.fullscreenMode=a===undefined?!this.fullscreenMode:a,this.addBookmark(!1),this.remove().create()},readonly:function(a){a=_undef(a,!0);var c=this,h=c.edit,_=h.doc;c.designMode?c.toolbar.disableAll(a,[]):_each(c.noDisableItems,function(){c.toolbar[a?"disable":"enable"](this)}),_IE?_.body.contentEditable=!a:_.designMode=a?"off":"on",h.textarea[0].disabled=a},createMenu:function(a){var c=this,h=a.name,_=c.toolbar.get(h),g=_.pos();return a.x=g.x,a.y=g.y+_.height(),a.z=c.options.zIndex,a.shadowMode=_undef(a.shadowMode,c.shadowMode),a.selectedColor!==undefined?(a.cls="ke-colorpicker-"+c.themeType,a.noColor=c.lang("noColor"),c.menu=_colorpicker(a)):(a.cls="ke-menu-"+c.themeType,a.centerLineMode=!1,c.menu=_menu(a)),c.menu},hideMenu:function(){return this.menu.remove(),this.menu=null,this},hideContextmenu:function(){return this.contextmenu.remove(),this.contextmenu=null,this},createDialog:function(a){{var c=this;a.name}if(a.z=c.options.zIndex,a.shadowMode=_undef(a.shadowMode,c.shadowMode),a.closeBtn=_undef(a.closeBtn,{name:c.lang("close"),click:function(){c.hideDialog(),_IE&&c.cmd&&c.cmd.select()}}),a.noBtn=_undef(a.noBtn,{name:c.lang(a.yesBtn?"no":"close"),click:function(){c.hideDialog(),_IE&&c.cmd&&c.cmd.select()}}),"page"!=c.dialogAlignType&&(a.alignEl=c.container),a.cls="ke-dialog-"+c.themeType,c.dialogs.length>0){var h=c.dialogs[0],_=c.dialogs[c.dialogs.length-1];h.setMaskIndex(_.z+2),a.z=_.z+3,a.showMask=!1}var g=_dialog(a);return c.dialogs.push(g),g},hideDialog:function(){var a=this;if(a.dialogs.length>0&&a.dialogs.pop().remove(),a.dialogs.length>0){var c=a.dialogs[0],h=a.dialogs[a.dialogs.length-1];c.setMaskIndex(h.z-1)}return a},errorDialog:function(a){var c=this,h=c.createDialog({width:750,title:c.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'}),_=K("iframe",h.div),g=K.iframeDoc(_);return g.open(),g.write(a),g.close(),K(g.body).css("background-color","#FFF"),_[0].contentWindow.focus(),c}},_instances=[],K.remove=function(a){_eachEditor(a,function(i){this.remove(),_instances.splice(i,1)})},K.sync=function(a){_eachEditor(a,function(){this.sync()})},K.html=function(a,c){_eachEditor(a,function(){this.html(c)})},K.insertHtml=function(a,c){_eachEditor(a,function(){this.insertHtml(c)})},K.appendHtml=function(a,c){_eachEditor(a,function(){this.appendHtml(c)})},_IE&&7>_V&&_nativeCommand(document,"BackgroundImageCache",!0),K.EditorClass=KEditor,K.editor=_editor,K.create=_create,K.instances=_instances,K.plugin=_plugin,K.lang=_lang,_plugin("core",function(a){var c=this,h={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};if(c.afterSetHtml(function(){c.options.afterChange&&c.options.afterChange.call(c)}),c.afterCreate(function(){if("form"==c.syncType){for(var h=a(c.srcElement),_=!1;h=h.parent();)if("form"==h.name){_=!0;break}if(_){h.bind("submit",function(){c.sync(),a(window).bind("unload",function(){c.edit.textarea.remove()})});var g=a('[type="reset"]',h);g.click(function(){c.html(c.initContent),c.cmd.selection()}),c.beforeRemove(function(){h.unbind(),g.unbind()})}}}),c.clickToolbar("source",function(){c.edit.designMode?(c.toolbar.disableAll(!0),c.edit.design(!1),c.toolbar.select("source")):(c.toolbar.disableAll(!1),c.edit.design(!0),c.toolbar.unselect("source"),_GECKO?setTimeout(function(){c.cmd.selection()},0):c.cmd.selection()),c.designMode=c.edit.designMode}),c.afterCreate(function(){c.designMode||c.toolbar.disableAll(!0).select("source")}),c.clickToolbar("fullscreen",function(){c.fullscreen()}),c.fullscreenShortcut){var _=!1;c.afterCreate(function(){if(a(c.edit.doc,c.edit.textarea).keyup(function(e){27==e.which&&setTimeout(function(){c.fullscreen()},0)}),_){if(_IE&&!c.designMode)return;c.focus()}_||(_=!0)})}_each("undo,redo".split(","),function(i,a){h[a]&&c.afterCreate(function(){_ctrl(this.edit.doc,h[a],function(){c.clickToolbar(a)})}),c.clickToolbar(a,function(){c[a]()})}),c.clickToolbar("formatblock",function(){var a=c.lang("formatblock.formatBlock"),h={h1:28,h2:24,h3:18,H4:14,p:12},_=c.cmd.val("formatblock"),g=c.createMenu({name:"formatblock",width:"en"==c.langType?200:150});_each(a,function(a,v){var b="font-size:"+h[a]+"px;";"h"===a.charAt(0)&&(b+="font-weight:bold;"),g.addItem({title:'<span style="'+b+'" unselectable="on">'+v+"</span>",height:h[a]+12,checked:_===a||_===v,click:function(){c.select().exec("formatblock","<"+a+">").hideMenu()}})})}),c.clickToolbar("fontname",function(){var a=c.cmd.val("fontname"),h=c.createMenu({name:"fontname",width:150});_each(c.lang("fontname.fontName"),function(_,g){h.addItem({title:'<span style="font-family: '+_+';" unselectable="on">'+g+"</span>",checked:a===_.toLowerCase()||a===g.toLowerCase(),click:function(){c.exec("fontname",_).hideMenu()}})})}),c.clickToolbar("fontsize",function(){var a=c.cmd.val("fontsize"),h=c.createMenu({name:"fontsize",width:150});_each(c.fontSizeTable,function(i,_){h.addItem({title:'<span style="font-size:'+_+';" unselectable="on">'+_+"</span>",height:_removeUnit(_)+12,checked:a===_,click:function(){c.exec("fontsize",_).hideMenu()}})})}),_each("forecolor,hilitecolor".split(","),function(i,a){c.clickToolbar(a,function(){c.createMenu({name:a,selectedColor:c.cmd.val(a)||"default",colors:c.colorTable,click:function(h){c.exec(a,h).hideMenu()}})})}),_each("cut,copy,paste".split(","),function(i,a){c.clickToolbar(a,function(){c.focus();try{c.exec(a,null)}catch(e){alert(c.lang(a+"Error"))}})}),c.clickToolbar("about",function(){var a='<div style="margin:20px;"><div>KindEditor '+_VERSION+'</div><div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div></div>';c.createDialog({name:"about",width:350,title:c.lang("about"),body:a})}),c.plugin.getSelectedLink=function(){return c.cmd.commonAncestor("a")},c.plugin.getSelectedImage=function(){return _getImageFromRange(c.edit.cmd.range,function(a){return!/^ke-\w+$/i.test(a[0].className)})},c.plugin.getSelectedFlash=function(){return _getImageFromRange(c.edit.cmd.range,function(a){return"ke-flash"==a[0].className})},c.plugin.getSelectedMedia=function(){return _getImageFromRange(c.edit.cmd.range,function(a){return"ke-media"==a[0].className||"ke-rm"==a[0].className})},c.plugin.getSelectedAnchor=function(){return _getImageFromRange(c.edit.cmd.range,function(a){return"ke-anchor"==a[0].className})},_each("link,image,flash,media,anchor".split(","),function(i,a){var h=a.charAt(0).toUpperCase()+a.substr(1);_each("edit,delete".split(","),function(_,g){c.addContextmenu({title:c.lang(g+h),click:function(){c.loadPlugin(a,function(){c.plugin[a][g](),c.hideMenu()})},cond:c.plugin["getSelected"+h],width:150,iconClass:"edit"==g?"ke-icon-"+a:undefined})}),c.addContextmenu({title:"-"})}),c.plugin.getSelectedTable=function(){return c.cmd.commonAncestor("table")},c.plugin.getSelectedRow=function(){return c.cmd.commonAncestor("tr")},c.plugin.getSelectedCell=function(){return c.cmd.commonAncestor("td")},_each("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,rowsplit,colsplit,coldelete,rowdelete,insert,delete".split(","),function(i,a){var h=_inArray(a,["prop","delete"])<0?c.plugin.getSelectedCell:c.plugin.getSelectedTable;c.addContextmenu({title:c.lang("table"+a),click:function(){c.loadPlugin("table",function(){c.plugin.table[a](),c.hideMenu()
})},cond:h,width:170,iconClass:"ke-icon-table"+a})}),c.addContextmenu({title:"-"}),_each("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript,hr,print,bold,italic,underline,strikethrough,removeformat,unlink".split(","),function(i,a){h[a]&&c.afterCreate(function(){_ctrl(this.edit.doc,h[a],function(){c.cmd.selection(),c.clickToolbar(a)})}),c.clickToolbar(a,function(){c.focus().exec(a,null)})}),c.afterCreate(function(){function h(){_.range.moveToBookmark(g),_.select(),_WEBKIT&&(a("div."+y,v).each(function(){a(this).after("<br />").remove(!0)}),a("span.Apple-style-span",v).remove(!0),a("span.Apple-tab-span",v).remove(!0),a("span[style]",v).each(function(){"nowrap"==a(this).css("white-space")&&a(this).remove(!0)}),a("meta",v).remove());var h=v[0].innerHTML;v.remove(),""!==h&&(_WEBKIT&&(h=h.replace(/(<br>)\1/gi,"$1")),2===c.pasteType&&(h=h.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,""),/schemas-microsoft-com|worddocument|mso-\w+/i.test(h)?h=_clearMsWord(h,c.filterMode?c.htmlTags:a.options.htmlTags):(h=_formatHtml(h,c.filterMode?c.htmlTags:null),h=c.beforeSetHtml(h))),1===c.pasteType&&(h=h.replace(/&nbsp;/gi," "),h=h.replace(/\n\s*\n/g,"\n"),h=h.replace(/<br[^>]*>/gi,"\n"),h=h.replace(/<\/p><p[^>]*>/gi,"\n"),h=h.replace(/<[^>]+>/g,""),h=h.replace(/ {2}/g," &nbsp;"),"p"==c.newlineTag?/\n/.test(h)&&(h=h.replace(/^/,"<p>").replace(/$/,"<br /></p>").replace(/\n/g,"<br /></p><p>")):h=h.replace(/\n/g,"<br />$&")),c.insertHtml(h,!0))}var _,g,v,b=c.edit.doc,y="__kindeditor_paste__",k=!1;a(b.body).bind("paste",function(e){if(0===c.pasteType)return void e.stop();if(!k){if(k=!0,a("div."+y,b).remove(),_=c.cmd.selection(),g=_.range.createBookmark(),v=a('<div class="'+y+'"></div>',b).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:a(g.start).pos().y+"px","white-space":"nowrap"}),a(b.body).append(v),_IE){var C=_.range.get(!0);C.moveToElementText(v[0]),C.select(),C.execCommand("paste"),e.preventDefault()}else _.range.selectNodeContents(v[0]),_.select();setTimeout(function(){h(),k=!1},0)}})}),c.beforeGetHtml(function(a){return _IE&&8>=_V&&(a=a.replace(/<div\s+[^>]*data-ke-input-tag="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(a,c){return unescape(c)}),a=a.replace(/(<input)((?:\s+[^>]*)?>)/gi,function(a,c,h){return/\s+type="[^"]+"/i.test(a)?a:c+' type="text"'+h})),a.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/gi,function(a,c,h,_){return c+_unescape(h).replace(/\s+/g," ")+_}).replace(/<img[^>]*class="?ke-(flash|rm|media)"?[^>]*>/gi,function(a){var c=_getAttrList(a),h=_getCssList(c.style||""),_=_mediaAttrs(c["data-ke-tag"]),g=_undef(h.width,""),v=_undef(h.height,"");return/px/i.test(g)&&(g=_removeUnit(g)),/px/i.test(v)&&(v=_removeUnit(v)),_.width=_undef(c.width,g),_.height=_undef(c.height,v),_mediaEmbed(_)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/gi,function(a){var c=_getAttrList(a);return'<a name="'+unescape(c["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(a,c,h){return"<script"+unescape(c)+">"+unescape(h)+"</script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(a,c,h){return"<noscript"+unescape(c)+">"+unescape(h)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/gi,function(a,c,h){return a=a.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(a,c,_){return c+_unescape(h)+_}),a=a.replace(/\s+data-ke-src="[^"]*"/i,"")}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/gi,function(a,c,h){return c+h})}),c.beforeSetHtml(function(a){return _IE&&8>=_V&&(a=a.replace(/<input[^>]*>|<(select|button)[^>]*>[\s\S]*?<\/\1>/gi,function(a){var c=_getAttrList(a),h=_getCssList(c.style||"");return"none"==h.display?'<div class="ke-display-none" data-ke-input-tag="'+escape(a)+'"></div>':a})),a.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/gi,function(a){var h=_getAttrList(a);return h.src=_undef(h.src,""),h.width=_undef(h.width,0),h.height=_undef(h.height,0),_mediaImg(c.themesPath+"common/blank.gif",h)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/gi,function(a){var h=_getAttrList(a);return h.href!==undefined?a:'<img class="ke-anchor" src="'+c.themesPath+'common/anchor.gif" data-ke-name="'+escape(h.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(a,c,h){return'<div class="ke-script" data-ke-script-attr="'+escape(c)+'">'+escape(h)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/gi,function(a,c,h){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(c)+'">'+escape(h)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/gi,function(a,c,h,_,g){return a.match(/\sdata-ke-src="[^"]*"/i)?a:a=c+h+'="'+_+'" data-ke-src="'+_escape(_)+'"'+g}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/gi,function(a,c,h){return c+"data-ke-"+h}).replace(/<table[^>]*\s+border="0"[^>]*>/gi,function(a){return a.indexOf("ke-zeroborder")>=0?a:_addClassToTag(a,"ke-zeroborder")})})})}}(window);