KindEditor.plugin("filemanager",function(a){function c(a,c,v){return a+" ("+Math.ceil(c/1024)+"KB, "+v+")"}function v(a,v){v.is_dir?a.attr("title",v.filename):a.attr("title",c(v.filename,v.filesize,v.datetime))}var h=this,g="filemanager",k=a.undef(h.fileManagerJson,h.basePath+"php/file_manager_json.php"),_=h.pluginsPath+g+"/images/",b=h.lang(g+".");h.plugin.filemanagerDialog=function(c){function w(c,v,g){var _="path="+c+"&order="+v+"&dir="+j;z.showLoading(h.lang("ajaxLoading")),a.ajax(a.addParam(k,_+"&"+(new Date).getTime()),function(a){z.hideLoading(),g(a)})}function y(c,v,h,g){var k=a.formatUrl(v.current_url+h.filename,"absolute"),_=encodeURIComponent(v.current_dir_path+h.filename+"/");c.click(h.is_dir?function(){w(_,F.val(),g)}:h.is_photo?function(){P.call(this,k,h.filename)}:function(){P.call(this,k,h.filename)}),K.push(c)}function C(c,v){function h(){"VIEW"==D.val()?w(c.current_dir_path,F.val(),I):w(c.current_dir_path,F.val(),T)}a.each(K,function(){this.unbind()}),W.unbind(),D.unbind(),F.unbind(),c.current_dir_path&&W.click(function(){w(c.moveup_dir_path,F.val(),v)}),D.change(h),F.change(h),V.html("")}function T(c){C(c,T);var v=document.createElement("table");v.className="ke-table",v.cellPadding=0,v.cellSpacing=0,v.border=0,V.append(v);for(var h=c.file_list,i=0,g=h.length;g>i;i++){var k=h[i],w=a(v.insertRow(i));w.mouseover(function(){a(this).addClass("ke-on")}).mouseout(function(){a(this).removeClass("ke-on")});var I=_+(k.is_dir?"folder-16.gif":"file-16.gif"),E=a('<img src="'+I+'" width="16" height="16" alt="'+k.filename+'" align="absmiddle" />'),L=a(w[0].insertCell(0)).addClass("ke-cell ke-name").append(E).append(document.createTextNode(" "+k.filename));!k.is_dir||k.has_file?(w.css("cursor","pointer"),L.attr("title",k.filename),y(L,c,k,T)):L.attr("title",b.emptyFolder),a(w[0].insertCell(1)).addClass("ke-cell ke-size").html(k.is_dir?"-":Math.ceil(k.filesize/1024)+"KB"),a(w[0].insertCell(2)).addClass("ke-cell ke-datetime").html(k.datetime)}}function I(c){C(c,I);for(var h=c.file_list,i=0,g=h.length;g>i;i++){var k=h[i],w=a('<div class="ke-inline-block ke-item"></div>');V.append(w);var T=a('<div class="ke-inline-block ke-photo"></div>').mouseover(function(){a(this).addClass("ke-on")}).mouseout(function(){a(this).removeClass("ke-on")});w.append(T);var E=c.current_url+k.filename,L=k.is_dir?_+"folder-64.gif":k.is_photo?E:_+"file-64.gif",j=a('<img src="'+L+'" width="80" height="80" alt="'+k.filename+'" />');!k.is_dir||k.has_file?(T.css("cursor","pointer"),v(T,k),y(T,c,k,I)):T.attr("title",b.emptyFolder),T.append(j),w.append('<div class="ke-name" title="'+k.filename+'">'+k.filename+"</div>")}}var E=a.undef(c.width,650),L=a.undef(c.height,510),j=a.undef(c.dirName,""),N=a.undef(c.viewType,"VIEW").toUpperCase(),P=c.clickFn,S=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+_+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+b.moveup+"</a>","</div>",'<div class="ke-right">',b.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+b.viewImage+"</option>",'<option value="LIST">'+b.listImage+"</option>","</select> ",b.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+b.fileName+"</option>",'<option value="SIZE">'+b.fileSize+"</option>",'<option value="TYPE">'+b.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join(""),z=h.createDialog({name:g,width:E,height:L,title:h.lang(g),body:S}),M=z.div,V=a(".ke-plugin-filemanager-body",M),W=(a('[name="moveupImg"]',M),a('[name="moveupLink"]',M)),D=(a('[name="viewServer"]',M),a('[name="viewType"]',M)),F=a('[name="orderType"]',M),K=[];return D.val(N),w("",F.val(),"VIEW"==N?I:T),z}});