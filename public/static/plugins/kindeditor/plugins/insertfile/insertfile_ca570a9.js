KindEditor.plugin("insertfile",function(a){var c=this,g="insertfile",v=a.undef(c.allowFileUpload,!0),k=a.undef(c.allowFileManager,!1),b=a.undef(c.formatUploadUrl,!0),h=a.undef(c.uploadJson,c.basePath+"php/upload_json.php"),w=a.undef(c.extraFileUploadParams,{}),y=a.undef(c.filePostName,"imgFile"),U=c.lang(g+".");c.plugin.fileDialog=function(F){var D=a.undef(F.fileUrl,"http://"),S=a.undef(F.fileTitle,""),P=F.clickFn,T=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+U.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+U.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+U.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+U.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join(""),L=c.createDialog({name:g,width:450,title:c.lang(g),body:T,yesBtn:{name:c.lang("yes"),click:function(){var g=a.trim(j.val()),v=E.val();return"http://"==g||a.invalidUrl(g)?(alert(c.lang("invalidUrl")),void j[0].focus()):(""===a.trim(v)&&(v=g),void P.call(c,g,v))}}}),N=L.div,j=a('[name="url"]',N),B=a('[name="viewServer"]',N),E=a('[name="title"]',N);if(v){var _=a.uploadbutton({button:a(".ke-upload-button",N)[0],fieldName:y,url:a.addParam(h,"dir=file"),extraParams:w,afterUpload:function(v){if(L.hideLoading(),0===v.error){var k=v.url;b&&(k=a.formatUrl(k,"absolute")),j.val(k),c.afterUpload&&c.afterUpload.call(c,k,v,g),alert(c.lang("uploadSuccess"))}else alert(v.message)},afterError:function(a){L.hideLoading(),c.errorDialog(a)}});_.fileBox.change(function(){L.showLoading(c.lang("uploadLoading")),_.submit()})}else a(".ke-upload-button",N).hide();k?B.click(function(){c.loadPlugin("filemanager",function(){c.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(g){c.dialogs.length>1&&(a('[name="url"]',N).val(g),c.afterSelectFile&&c.afterSelectFile.call(c,g),c.hideDialog())}})})}):B.hide(),j.val(D),E.val(S),j[0].focus(),j[0].select()},c.clickToolbar(g,function(){c.plugin.fileDialog({clickFn:function(a,g){var v='<a class="ke-insertfile" href="'+a+'" data-ke-src="'+a+'" target="_blank">'+g+"</a>";c.insertHtml(v).hideDialog().focus()}})})});