KindEditor.plugin("flash",function(a){var h=this,g="flash",c=h.lang(g+"."),v=a.undef(h.allowFlashUpload,!0),k=a.undef(h.allowFileManager,!1),b=a.undef(h.formatUploadUrl,!0),w=a.undef(h.extraFileUploadParams,{}),y=a.undef(h.filePostName,"imgFile"),U=a.undef(h.uploadJson,h.basePath+"php/upload_json.php");h.plugin.flash={edit:function(){var F=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+c.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+c.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+c.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+c.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" /> ',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+c.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" /> ',"</div>","</div>"].join(""),S=h.createDialog({name:g,width:450,title:h.lang(g),body:F,yesBtn:{name:h.lang("yes"),click:function(){var g=a.trim(D.val()),c=H.val(),v=T.val();if("http://"==g||a.invalidUrl(g))return alert(h.lang("invalidUrl")),void D[0].focus();if(!/^\d*$/.test(c))return alert(h.lang("invalidWidth")),void H[0].focus();if(!/^\d*$/.test(v))return alert(h.lang("invalidHeight")),void T[0].focus();var k=a.mediaImg(h.themesPath+"common/blank.gif",{src:g,type:a.mediaType(".swf"),width:c,height:v,quality:"high"});h.insertHtml(k).hideDialog().focus()}}}),P=S.div,D=a('[name="url"]',P),L=a('[name="viewServer"]',P),H=a('[name="width"]',P),T=a('[name="height"]',P);if(D.val("http://"),v){var B=a.uploadbutton({button:a(".ke-upload-button",P)[0],fieldName:y,extraParams:w,url:a.addParam(U,"dir=flash"),afterUpload:function(c){if(S.hideLoading(),0===c.error){var v=c.url;b&&(v=a.formatUrl(v,"absolute")),D.val(v),h.afterUpload&&h.afterUpload.call(h,v,c,g),alert(h.lang("uploadSuccess"))}else alert(c.message)},afterError:function(a){S.hideLoading(),h.errorDialog(a)}});B.fileBox.change(function(){S.showLoading(h.lang("uploadLoading")),B.submit()})}else a(".ke-upload-button",P).hide();k?L.click(function(){h.loadPlugin("filemanager",function(){h.plugin.filemanagerDialog({viewType:"LIST",dirName:"flash",clickFn:function(g){h.dialogs.length>1&&(a('[name="url"]',P).val(g),h.afterSelectFile&&h.afterSelectFile.call(h,g),h.hideDialog())}})})}):L.hide();var N=h.plugin.getSelectedFlash();if(N){var W=a.mediaAttrs(N.attr("data-ke-tag"));D.val(W.src),H.val(a.removeUnit(N.css("width"))||W.width||0),T.val(a.removeUnit(N.css("height"))||W.height||0)}D[0].focus(),D[0].select()},"delete":function(){h.plugin.getSelectedFlash().remove(),h.addBookmark()}},h.clickToolbar(g,h.plugin.flash.edit)});