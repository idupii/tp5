KindEditor.plugin("image",function(a){var g=this,c="image",h=a.undef(g.allowImageUpload,!0),v=a.undef(g.allowImageRemote,!0),b=a.undef(g.formatUploadUrl,!0),k=a.undef(g.allowFileManager,!1),w=a.undef(g.uploadJson,g.basePath+"php/upload_json.php"),y=a.undef(g.imageTabIndex,0),U=g.pluginsPath+"image/images/",I=a.undef(g.extraFileUploadParams,{}),T=a.undef(g.filePostName,"imgFile"),S=a.undef(g.fillDescAfterUploadImage,!1),D=g.lang(c+".");g.plugin.imageDialog=function(h){function v(a,g){J.val(a),K.val(g),Q=a,X=g}var y=(h.imageUrl,a.undef(h.imageWidth,""),a.undef(h.imageHeight,""),a.undef(h.imageTitle,""),a.undef(h.imageAlign,""),a.undef(h.showRemote,!0)),F=a.undef(h.showLocal,!0),L=a.undef(h.tabIndex,0),W=h.clickFn,_="kindeditor_upload_iframe_"+(new Date).getTime(),P=[];for(var B in I)P.push('<input type="hidden" name="'+B+'" value="'+I[B]+'" />');var A,H=['<div style="padding:20px;">','<div class="tabs"></div>','<div class="tab1" style="display:none;">','<div class="ke-dialog-row">','<label for="remoteUrl" style="width:60px;">'+D.remoteUrl+"</label>",'<input type="text" id="remoteUrl" class="ke-input-text" name="url" value="" style="width:200px;" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+D.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="remoteWidth" style="width:60px;">'+D.size+"</label>",D.width+' <input type="text" id="remoteWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> ',D.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> ','<img class="ke-refresh-btn" src="'+U+'refresh.png" width="16" height="16" alt="" style="cursor:pointer;" title="'+D.resetSize+'" />',"</div>",'<div class="ke-dialog-row">','<label style="width:60px;">'+D.align+"</label>",'<input type="radio" name="align" class="ke-inline-block" value="" checked="checked" /> <img name="defaultImg" src="'+U+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="left" /> <img name="leftImg" src="'+U+'align_left.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="right" /> <img name="rightImg" src="'+U+'align_right.gif" width="23" height="25" alt="" />',"</div>",'<div class="ke-dialog-row">','<label for="remoteTitle" style="width:60px;">'+D.imgTitle+"</label>",'<input type="text" id="remoteTitle" class="ke-input-text" name="title" value="" style="width:200px;" />',"</div>","</div>",'<div class="tab2" style="display:none;">','<iframe name="'+_+'" style="display:none;"></iframe>','<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+_+'" action="'+a.addParam(w,"dir=image")+'">','<div class="ke-dialog-row">',P.join(""),'<label style="width:60px;">'+D.localUrl+"</label>",'<input type="text" name="localUrl" class="ke-input-text" tabindex="-1" style="width:200px;" readonly="true" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+D.upload+'" />',"</div>","</form>","</div>","</div>"].join(""),R=F||k?450:400,j=F&&y?300:250,E=g.createDialog({name:c,width:R,height:j,title:g.lang(c),body:H,yesBtn:{name:g.lang("yes"),click:function(){if(!E.isLoading){if(F&&y&&A&&1===A.selectedIndex||!y)return""==O.fileBox.val()?void alert(g.lang("pleaseSelectFile")):(E.showLoading(g.lang("uploadLoading")),O.submit(),void z.val(""));var c=a.trim(N.val()),h=J.val(),v=K.val(),b=C.val(),k="";return G.each(function(){return this.checked?(k=this.value,!1):void 0}),"http://"==c||a.invalidUrl(c)?(alert(g.lang("invalidUrl")),void N[0].focus()):/^\d*$/.test(h)?/^\d*$/.test(v)?void W.call(g,c,b,h,v,0,k):(alert(g.lang("invalidHeight")),void K[0].focus()):(alert(g.lang("invalidWidth")),void J[0].focus())}}},beforeRemove:function(){$.unbind(),J.unbind(),K.unbind(),V.unbind()}}),M=E.div,N=a('[name="url"]',M),z=a('[name="localUrl"]',M),$=a('[name="viewServer"]',M),J=a('.tab1 [name="width"]',M),K=a('.tab1 [name="height"]',M),V=a(".ke-refresh-btn",M),C=a('.tab1 [name="title"]',M),G=a('.tab1 [name="align"]',M);y&&F?(A=a.tabs({src:a(".tabs",M),afterSelect:function(){}}),A.add({title:D.remoteImage,panel:a(".tab1",M)}),A.add({title:D.localImage,panel:a(".tab2",M)}),A.select(L)):y?a(".tab1",M).show():F&&a(".tab2",M).show();var O=a.uploadbutton({button:a(".ke-upload-button",M)[0],fieldName:T,form:a(".ke-form",M),target:_,width:60,afterUpload:function(h){if(E.hideLoading(),0===h.error){var v=h.url;b&&(v=a.formatUrl(v,"absolute")),g.afterUpload&&g.afterUpload.call(g,v,h,c),S?(a(".ke-dialog-row #remoteUrl",M).val(v),a(".ke-tabs-li",M)[0].click(),a(".ke-refresh-btn",M).click()):W.call(g,v,h.title,h.width,h.height,h.border,h.align)}else alert(h.message)},afterError:function(a){E.hideLoading(),g.errorDialog(a)}});O.fileBox.change(function(){z.val(O.fileBox.val())}),k?$.click(function(){g.loadPlugin("filemanager",function(){g.plugin.filemanagerDialog({viewType:"VIEW",dirName:"image",clickFn:function(c){g.dialogs.length>1&&(a('[name="url"]',M).val(c),g.afterSelectFile&&g.afterSelectFile.call(g,c),g.hideDialog())}})})}):$.hide();var Q=0,X=0;return V.click(function(){var g=a('<img src="'+N.val()+'" />',document).css({position:"absolute",visibility:"hidden",top:0,left:"-1000px"});g.bind("load",function(){v(g.width(),g.height()),g.remove()}),a(document.body).append(g)}),J.change(function(){Q>0&&K.val(Math.round(X/Q*parseInt(this.value,10)))}),K.change(function(){X>0&&J.val(Math.round(Q/X*parseInt(this.value,10)))}),N.val(h.imageUrl),v(h.imageWidth,h.imageHeight),C.val(h.imageTitle),G.each(function(){return this.value===h.imageAlign?(this.checked=!0,!1):void 0}),y&&0===L&&(N[0].focus(),N[0].select()),E},g.plugin.image={edit:function(){var a=g.plugin.getSelectedImage();g.plugin.imageDialog({imageUrl:a?a.attr("data-ke-src"):"http://",imageWidth:a?a.width():"",imageHeight:a?a.height():"",imageTitle:a?a.attr("title"):"",imageAlign:a?a.attr("align"):"",showRemote:v,showLocal:h,tabIndex:a?0:y,clickFn:function(c,h,v,b,k,w){a?(a.attr("src",c),a.attr("data-ke-src",c),a.attr("width",v),a.attr("height",b),a.attr("title",h),a.attr("align",w),a.attr("alt",h)):g.exec("insertimage",c,h,v,b,k,w),setTimeout(function(){g.hideDialog().focus()},0)}})},"delete":function(){var a=g.plugin.getSelectedImage();"a"==a.parent().name&&(a=a.parent()),a.remove(),g.addBookmark()}},g.clickToolbar(c,g.plugin.image.edit)});